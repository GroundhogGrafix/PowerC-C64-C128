KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK-C1115.OBJS-C1116.OBJS-C1117.OBJS-C1118.OBJS-C1119.OBJS-C1120.OBJS-C1125.OBJS-C1133.OBJS-C1134.OBJS-C1135.OBJS-C1136.OBJS-C1137.OBJS-C1138.OBJS-C1139.OBJS-CALLOC.OBJS-CGETCHAR.OBJS-CMULTI.OBJS-CONV25.OBJS-CONV52.OBJS-CSTART.OBJS-CSTARKK CALDEFS.OBJS-MALLOC.OBJS-OPEN.OBJS-PRINTF.OBJS-PUTCHAR.OBJS-PUTS.OBJS-PUTW.OBJS-RANDOM.OBJS-REALLOC.OBJS-QSORT.OS-SCANF.OBJS-SETJMP.OBJS-STRING.OBJS-STRINGN.OBJS-SYS.OBJETCHAR.OBJS-CMULTI.OBJS-CONV25.OBJS-CONV52.OBJS-CSTART.OBJS-CSTARKKKKKKKKT2.OBJS-CTYPE.OBJS-DEVICE.OBJS-DIRECTORY.OBJS-FEOF.OBJS-FERROR.OBJS-FGETS.OBJS-FLOATCMP.OBJS-FOPEN.OBJS-FREAD.OBJS-FREE.OBJS-FREXP.OBJS-FUNCTINIT.OBJS-FWRITE.OBJS-GETCHAR.OBJS-GETS.OBJS-GETW.OBJS-HIGHMEM.OBJS-INDEX.OBJS-INSQUE.OBJS-LO	
  2062   L0L%LULLLLc  `
 &e	'f	&&	'		t	X 	Щ 
  Щ!Щ 
>      A[     	L H h`H h@HHݬ	<L`L8TN  T	 N L8OTR `  ZI0
[ZZZeZ
e[ZZ`	0: 8` ɠ  ɠ ʆ*`+ Y L,S ,W + YϢ  ʽ,   	;SOURCE=08 0;DESTINATION=10 0P-NEWSHELLP-ASSM.SHP-EXEC.SHP-FORMAT.SHP-NEWCC.SH;PAUSE - COMPILER ROUTINESP-COMPILERP-TRANSLATORP-LINK.SHP-TRIM.SHP-ED.SHP-CED.SHS-ACOS.OBJS-ASIN.OBJS-ATAN.OBJS-ATAN2.OBJS-CABS.OBJS-CEIL.OBJS-COS.OBJS-CO		 ML<<Lȱ	ML%c D LU LX LO >LC {LS LF jLG 2L  LL LQMQLQ`KL<Z<[L X` Q T[QI[ZIZZ[-T Z8(Q[	
٠ >? LR0: =0:  	0  @A  >? L >?  n  LJ #`  
` `)	+ {8` #
1#8
	0$	0- +8`>*?+  *1

ȱ*L1q*80#ȱ* 6 45    : STA (45),Y "j 76,204,255: JMP CLRCHN   :3:4:520 a1,A,B$,B,C:A"SOURCE"A","B$","B","C g 2,A,B$,B,C:A"DESTINATION"A","B$","B","C  162,  3    : LDX #3  32,198,255: JSR CHKIN 160,  0    : LDY #0 	Lr Lr	  LqH64hH\ɤ^ɯ]	d g	hH  g	h`hLH  hLN :
::		   		&ѻ	 	L LJCONNULSCNPRN  ) L\
 ɠ<	  '8*+`*+      (*+`*+ Ӡ ` 1 e +8`COMMAND NOT FOUND *`0: .SH 	0 *+         ` 8`   Y
  W8	.OBJS-ATOI.OBJS-BSTRING.OBJS-C0016.OBJS-C0018.OBJS-C0019.OBJS-C0024.OBJS-C0025.OBJS-C0027.OBJS-C0031.OBJS-C0033.OBJS-C0035.OBJS-C0037.OBJS-C0039.OBJS-C0042.OBJS-C0043.OBJS-C0044.OBJS-C0046.OBJS-C0047.OBJS-C0059.OBJS-C0061.OBJS-C0063.	-	[QZXX
.TTЦTKX0`
d   'H	K<eL  ݽ    LLLiLKh`H	K<eL  ݽ VUSPVP   5 -E  USEQUPPQ.VUQLLiLKhVSU.P	L1@*A+ *05:1ȱ*+)-# 
#-`DEVICE:    DRIVE:   : +8`NO DRIVE  
)\=< 2 q*r+ *)`!\ Т +`WRONG NUMBER OF ARGS  ` ` WX  W `WX W `   	OBJS-C0065.OBJS-C0067.OBJS-C0069.OBJS-C0071.OBJS-C0073.OBJS-C0075.OBJS-C0077.OBJS-C0079.OBJS-C0082.OBJS-C0066.OBJS-C0070.OBJS-C0074.OBJS-C0078.OBJS-C0081.OBJS-C0084.OBJS-C0095.OBJS-C0096.OBJS-C0097.OBJS-C0100.OBJS-C0112.OBJS-C105.OBJ	 r
L+>! > ΢
L+ 
L+)" 
 " 
  ɠ  L	)   * 
`CAN'T OPEN INPUT FILE CAN'T OPEN OUTPUT FILE NO PRINTER  )< =<>?L i <ȩ i<`,H h 	`YXWiY
\H[H`BYE  LOAD DIRS DIR  DEL  REN  TYPE LS   L    RM   MV   PR   DOS  WORK SYS  COL   z55YqC L >? *`$0: * H	0 )>? LhL{ h  n    u 	SH.OBJS-EXP.OBJS-FABS.OBJS-FLOOR.OBJS-HYPOT.OBJS-LOG.OBJS-LOG10.OBJS-MATH.LS-POW.OBJS-SIN.OBJS-SINH.OBJS-SQRT.OBJS-TAN.OBJS-TANH.OBJ;PAUSE - SYSTEM LIBRARY FUNCTIONSS-STDLIB.LS-STDLIB2.LS-SYSLIB.LS-SYSLIB2.LS-ABORT.OBJS-ABS.OBJS-ATOF	
0P`  \[JJJJX	.XZ&[\L0123456789ABCDEF  [1X\[JJJJ)X	.XZ&[\LL<L`KL< <!L P P𘪤K` Nȱ-Nȱ0 R O. LPL`*L XL    L  Ȱ L08`WX W ` n  LJ #`  
` `)	+ {8` #
1#8
	0$	0- +8`>*?+  *1

ȱ*L1q*80#ȱ*S-C1021.OBJS-C1022.OBJS-C1023.OBJS-C1025.OBJS-C1027.OBJS-C1028.OBJS-C1029.OBJS-C1031.OBJS-C1039.OBJS-C1040.OBJS-C1044.OBJS-C1045.OBJS-C1102.OBJS-C1104.OBJS-C1105.OBJS-C1106.OBJS-C1107.OBJS-C1108.OBJS-C1109.OBJS-C1110.OBJS-C1113.OBJS	    `M-RN <N`   	<     ` `8` H h`4  .	 8` ` U<<L L UL U<L L	p kH h  (8 f j (   	0 ɩ    LA I@L `
d     '` O  ` 8` H  h` >? B   '   '`)hhL{S0:  	0	 32,207,255: JSR CHRIN ,153,  0,193: STA $C100,Y C200        : INY b$165,144    : LDA $90 ;ST }.208,  4    : BNE *+6 8192,255    : CPY #$FF B208,241    : BNE *-13 L152        : TYA V160,  2    : LDY #2 `145, w  RM NEWCC.SH  01 ...  LINK    NEWCC.O  C64KERNAL.O  SHELLCENV.O    OUTPUT FILE NAME: NEWCC.SH  IL .BYTE $0D .BYTE "...CONCATENATING OBJECT FILE..." .BYTE $0D, $00SIZERO .BYTE "I0:" .BYTE $0D, $00SSTEMP .BYTE "S0:XXXTEMP*" .BY
ET DEVICE & DRIVE (FROM ARGS);GDEVDRV LDA ARGV+2 STA $2A LDA ARGV+3 STA $2B LDX #0 LDY #0 LDA ($2A),Y CMP #'1 BNE T1720F LDX #$0A INY LDA ($2A),Y BNE T1720F JMP DRVNOTPT1720F TXA CLC ADC ($2A),Y SEC SBC #'0 STA DEVNUM INY LDA ($2A)   RM NEWCC.SH\R  01 ...  LINK\R    NEWCC.O\R  C64KERNAL.O\R  SHELLCENV.O\R  \R    .IN OUTPUT FILE NAME: NEWCC.SH\R  $0D .BYTE "...CONCATENATING OBJECT FILE..." .BYTE $0D, $00SIZERO .BYTE "I0:" .BYTE $0D, $00SSTEMP .BYTE "S0:XXXTEMP*" .BY
	7
  F$="CSTART":OPEN1,8,15,"S0:"+F$:CLOSE1:SAVEF$,8 E  A  210 v( 45,0:46,23::  SET BEGINING FOR VARIABLES |F : P  360:  A0  320   "INITIALIZE RAM DISK         N";:  A$  :  F0:  (A$,1)"Y"   F1  D10  : 	  "RAM
RZERO+1 STA SEQZERO+1 LDX #<SRZERO LDY #>SRZERO JSR STRLOAD LDX ARGV+4 LDY ARGV+5 JSR STRAPND LDX #<SEQZERO LDY #>SEQZERO JSR STRAPND LDX ARGV+2 LDY ARGV+3 JSR STRAPND JMP SNDWRK  ; AND RETURN CLC;; TYPE - TYPE A FILE;DOTYPE JSR CHK2ARG
NOTP LDX DEVNUM LDY DRVNUM RTS;DRVDVBF .BYTE "DEVICE: "DEVNUM .BYTE "   DRIVE: "DRVNUM .BYTE $00,$0D,$0D,0;;DRVNOTP LDX #<SDRVNP LDY #>SDRVNP JSR STROUT SEC RTSSDRVNP .BYTE "NO DRIVE"SNEWLIN .BYTE $0D,0;; .IFNE COLCMD,0;;; DOCOL - S
A1:V25:(RV)VA0  C A0  " RAM EXPANDER NOT PRESENT" I jA$"":1,8,2,"0:COPY-DIR,S,R X4915249181:S:X,S: S8:S$"0:":D9:D$"0:":A$(999) X0999:1,A$(X):ST0 1:INX:X1 XX1:INX A$A$(
; STORE IF SUCCESSFUL NEW DEVICE/DRIVE STY WRKDRV LDA #<KWRKFIL JSR OPNWRKT1635F CLC RTS;DOSYS LDX SYSDEV LDY SYSDRV JSR DOWS BCS T1636F STX SYSDEV  ; STORE IF SUCCESSFUL NEW DEVICE/DRIVE STY SYSDRVT1636F CLC RTS;;; DOWS - DO WORK AND SY
 ($2A),Y INX INX CPX $29 BCC T1810B CLC RTS;SAVX = T1810VX+1COLTBL .WORD $0286   ; CHAR (FOREGROUND) COLOUR .WORD $D021 ; BACKGROUND COLOUR 1 .WORD DUMMY ; DUMMY, FOR STATUS LINE .WORD $D020 ; BORDER COLOURDUMMY = T1810VX+1 ; OK IN THIS INST
DOS64.BIN*",8,1 	 : D	   25356 :  PRINT EMBEDDED COPYRIGHT NOTICE J	 : V	  65418 \	 : 	   SET RAMDISK UNIT# (U) AND INTERFACE PAGE (P) (NOTE 22=$1600) 	  780,D:  781,22 :  LDA #9: LDX #$16 	: 	  INSTALL RAMDISK TO SPECIFIED EXTENT
IVE DEVICE;  PASS: X=DEVICE, Y=DRIVE;  SHDRVDV LDA #$20 STA DEVNUM TXA CMP #10 BCC T1710F LDX #'1 STX DEVNUM SEC SBC #10T1710F ORA #'0 STA DEVNUM+1 TYA ORA #'0 STA DRVNUM LDX #<DRVDVBF LDY #>DRVDVBF JSR STROUT SEC RTS;; GDEVDRV - G NDARD...CAUSE PROBLEMS?$29 BCC T1810B CLC RTS;SAVX = T1810VX+1COLTBL .WORD $0286   ; CHAR (FOREGROUND) COLOUR .WORD $D021 ; BACKGROUND COLOUR 1 .WORD DUMMY ; DUMMY, FOR STATUS LINE .WORD $D020 ; BORDER COLOURDUMMY = T1810VX+1 ; OK IN THIS INST
X):A$(X)"":(A$,1)";"600 0(A$,6)";PAUSE"550 n"INSERT DISK W/"(A$,10):"& PRESS RETURN";A$:"":520 &(A$,7)";SOURCE"570 0S((A$,9,2)):S$(A$,12,1)":":520 :(A$,12)";DESTINATION"590 DD((A$,14,2)):D$(A$,17,
,Y BEQ T1730F JMP DRVNOTPT1730F LDA ARGV+4 STA $2A LDA ARGV+5 STA $2B LDY #0 LDA ($2A),Y CMP #'0 BCC DRVNOTP CMP #'9+1 BCS DRVNOTP TAX INY LDA ($2A),Y BNE DRVNOTPT1750F TXA AND #15 ; DROP '0' STA DRVNUM LDX DEVNUM JSR OPNSYS BCS DRV	28)""("000"((Y),2),4):A0 4700:710:1:2:3:4:520 a1,A,B$,B,C:A"SOURCE"A","B$","B","C g 2,A,B$,B,C:A"DESTINATION"A","B$","B","C  162,  3    : LDX #3  32,198,255: JSR CHKIN 160,  0    : LDY #0 
 
 253503(F0) 
": 4
, F0  "  EXEC PROFILE" `
6 F  :  500: D10: "  EXEC STARTUP" }
J"";: 631,13:  198,1 
T"NEWSHELL",D,1 
^: 
h VERIFY PRESENCE OF RAM CARD 
rR57088:A0 
| R,0:(R)0  420 
V25:RV,V: 
S LDX ARGV+2 LDY ARGV+3 JSR STRLOAD LDX WRKDEV LDY #2 JSR SET4IN ; OPEN AND CHKIN ON CHANNEL 4T1630B JSR CHRRDST BCS T1640B JSR OUTCHR JMP T1630BT1640B JSR OUTLN CLC RTS;  ;DOWORK LDX WRKDEV LDY WRKDRV JSR DOWS BCS T1635F STX WRKDEV  
ET CHAR, BKG, STATUS, BORDER COLOURS;DOCOL LDA #5 JSR CHKARGS ASL A STA $29 LDX #2T1810B STX SAVX LDY ARGV+1,X LDA ARGV,X TAX JSR GETNUMT1810VX LDX #0 ; IN-LINE STORAGE FOR SAVX LDY COLTBL-2,X STY $2A LDY COLTBL-2+1,X STY $2B LDY #0 STA
1)":":520 'NA$:"IS AN UNKNOWN COMMAND":520 cX1,S,15:2,D,15:3,S,3,S$(A$,3):"COPYING    "(A$,3) s]700:A640 b4,D,4,D$(A$,3)","(A$,1)",W" gA(45)(46)256:A3,0:A4,193:710:A640 lY19999:49152:AST:4,A$; v

S COMMANDS;DOWS LDA $29 CMP #$01 BEQ SHDRVDV  ; SHOW, RETURN WITH SET CARRYT1640F CMP #3 BEQ GDEVDRV ; RETURNS (WITH SET CARRY ONLY             ; IF DEVICE/DRIVE IS BAD) JSR ARGCNT SEC  ; DON'T SAVE X,Y AS DEVICE/DRIVE RTS;; SHDRVDV - SHOW DR
ANCE; .FI;ARGCNT LDX #<SWRNARG LDY #>SWRNARG JSR STROUT CLC  ; SUCCESSFULLY FOUND BUILT-IN RTS  ; EVEN THOUGH  HAD ERRORSWRNARG .BYTE "WRONG NUMBER OF ARGS",13,13,0;; .DEF CMDLBUFCMDLBUF=$0200  ; PUT COMMAND BUFFER AT BASIC INPUT; NON-STAJSR OUTCHRT1310B JSR CHRRDST BCS DIREND JSR CHRRDST BCS DIREND JSR CHRRDST BCS DIREND PHA JSR CHRRDST TAY PLA TAXDOLSUBR STX VDOLA STY VDOLB LDX #0 LDY #3T1380B LDA #0 STA VDOLDT1390B SECT1390VA LDA #0 ; IN-LINE STORAGE FOR VDOLA SBC LC RTS;; CHECK ON 2 ARGS;CHK2ARGS LDA #2;; CHECK ON NUMBER OF ARGS;CHKARGS CMP $29 BEQ T1460F ; RETURN OK PLA ; POP RETURN OFF STACK PLA JMP ARGCNT;; DEL - DELETE A FILE;SSZERO .BYTE "S0:",0DODEL JSR CHK2ARGS LDA WRKDRV ORA #'0 STA S; THIS ALSO;   MOVES CMDLBUF FROM THE CASSETTE;   BUFFER, WHERE PROBLEMS MAY OCCUR;   (BUT NEVER HAVE FOR ME) TO SPACE;   INSIDE THE SHELL PROGRAM ITSELF;=1 ; 0 DISABLES THE EXTRA COMMANDSCOLCMD=1  ; 0 MEANS NO COL COMMAND;;; STANDARDOAD-1      ; 1  BYE .IFNE ,0 .WORD TODIRS-1      ; 2  DIRS .WORD TODIR-1       ; 3  DIR .WORD DODEL-1       ; 4  DEL .WORD DOREN-1       ; 5  REN .WORD DOTYPE-1      ; 6  TYPE .FI .WORD TODIRS-1      ; 7  LS .WORD TODIR-1       ; 8  L0 BEQ T1410F ; 1'S DIGIT DONE, OUTPUT ANYWAY CPX #0 BEQ T1420FT1410F ORA #'0 JSR OUTCHR INXT1420F DEY BPL T1380B LDA #$20 JSR OUTCHRT1340B JSR CHRRDST BCS DIREND BEQ T1350F JSR OUTCHR JMP T1340BT1350F LDA #$0D JSR OUTCHRT1360F LDA $CB  .REF STRLOAD,STRAPND,STREQ,STRFOPN .REF OPNSYS,STRECHN,STRBOUT; .REF SAVNMI,STROUT,OUTLN,OUTCHR .REF DOLOAD,CLRSTDO,FILCLS; .REF GETNUM;; SRCHCMD - LOOKS FOR BUILT-IN COMMAND;  EXECUTES, AND RETURNS WITH CLC IF FOUND;  SEC MEANS COMMAND IS NOT COME BACK;TOBYE JSR FILCLS JMP $FCE2  ; NEVER TO RETURN TO  SHELL;; LOAD - LOAD A COMMAND;TOLOAD JSR CHK2ARGS LDX ARGV+2 LDY ARGV+3 JSR DOLOAD CLC RTS;; DIR(S) - DIRECTORY ROUTINES;SDOLLAR .BYTE "$0:" .BYTE 0SSTAR .BYTE "*" .BYTE 0ET CHANNEL 4 AS INPUT;SET4IN LDA #$04 JSR STRFOPN BCC T1300F JSR STRBOUT CLC RTS ; ERROR RETURN;T1300F JSR CLRSTDO LDX #4 JSR CHKIN LDA #0 STA OREADST RTS;; READ A BYTE FROM ACTIVE CHANNEL;CHRRDST LDA #0 ; IN-LINE STORAGE FOR OREADST BCOMMANDS BNE T1190F ; YES, KEEP LOOKING SEC ; INDICATE BUILT-IN NOT FOUND RTS ; AND RETURN;T1190F INC $59 LDY $58 LDA $57 CLC ADC #5 TAX BCC T1180B INY BNE T1180B;JMPCMD LDA $59 ASL A TAX LDA RTNTBL+1,X PHA ; PUSH PCH FOR RTS LDA RTNT P T1280FT1260F CMP #$01 BEQ T1270F PLA JMP ARGCNT  ; AND RETURNT1270F LDX #<SSTAR LDY #>SSTAR JSR STRAPNDT1280F PLA TAX LDY #0 JSR SET4IN ; OPEN AND DO CHKIN ON CHAN 4 JSR CHRIN  ; INGNORE LOAD ADDR BYTES JSR CHRIN LDA #$0D   ; PRINT "\N" K - SEND STRING IN (X,Y) TO WORK DEVICE;SNDWRK LDX #<SNEWLIN LDY #>SNEWLIN JSR STRAPND LDX #<KWRKFIL JSR CHKOUT JSR STRBOUT  ; SEND TO WORK COMMAND CHANNEL JSR CLRCHN LDX WRKDEV JSR STRECHN BCC T1460F JSR STRBOUTT1460F CLC  ; ALWAYS RETURN C"LS",0,0,0 .BYTE "L",0,0,0,0 .BYTE "RM",0,0,0 .BYTE "MV",0,0,0 .BYTE "PR",0,0,0 .BYTE "DOS",0,0 .BYTE "WORK",0 .BYTE "SYS",0,0 .IFNE COLCMD,0 .BYTE "COL",0,0 .FI .BYTE 0;; TABLE OF COMMAND LOCATIONS;RTNTBL .WORD TOBYE-1 ; 0  BYE .WORD TOLDOLTBL1,Y STA VDOLCT1390VB LDA #0 ; IN-LINE STORAGE FOR VDOLB SBC DOLTBL2,Y BCC T1400F ; UNDERFLOW... STA VDOLBT1390VC LDA #0 ; IN-LINE STORAGE FOR VDOLC STA VDOLA INC VDOLD BNE T1390BT1400F LDA #0 ; IN-LINE STORAGE FOR VDOLD BNE T1410F CPY #
SZERO+1 LDX #<SSZERO LDY #>SSZERO JSR STRLOAD LDX ARGV+2 LDY ARGV+3 JSR STRAPND JMP SNDWRK  ; AND RETURN CLC;;; REN - RENAME A FILE;SRZERO .BYTE "R0:" .BYTE 0SEQZERO .BYTE "=0:" .BYTE 0DOREN LDA #3 JSR CHKARGS LDA WRKDRV ORA #'0 STA S CONSTANTS; MANY SHOULD BECOME;  EXTERNAL ABSOLUTE OR RELATIVE DEFINITIONS; .REF SYSDEV,SYSDRV,WRKDEV,WRKDRV;; KERNAL ROUTINES, ETC; .REF READST,STOP,CHKIN,CHKOUT,CLRCHN,CHRIN;SHFTFLG=$028D;; .DEF SRCHCMD; .REF OPNWRK,KWRKFIL,KSYSFIL,ARGV; .WORD DODEL-1       ; 9  RM .WORD DOREN-1       ; 10 MV .WORD DOTYPE-1      ; 11 PR .WORD DODOS-1       ; 12 DOS .WORD DOWORK-1      ; 13 WORK .WORD DOSYS-1       ; 14 SYS .IFNE COLCMD,0 .WORD DOCOL-1       ; 15 COL .FI;;; BYE - EXIT AND DON'EOR #$40 ORA SHFTFLG BNE T1360F JMP T1310BDIREND LDA #$0D JSR OUTCHR CLC RTS;DOLTBL1 .BYTE $01,$0A,$64,$E8 ; 1,10,100,1000DOLTBL2 .BYTE $00,$00,$00,$03VDOLA = T1390VA+1VDOLB = T1390VB+1VDOLC = T1390VC+1VDOLD = T1400F+1;; SET4IN - OPEN & ST BUILT-IN;; NOTE: CLC RETURNED EVEN IF BUILT-IN;  GETS ERRORS;SRCHCMD LDX #<CMDLBUF LDY #>CMDLBUF JSR STRLOAD LDA #0 STA $59 LDX #<CMDTBL LDY #>CMDTBLT1180B JSR STREQ BEQ JMPCMD ; BUILT-IN FOUND, DO IT LDY #0 LDA ($57),Y ; CHECK FOR MORE 	;TODIRS LDY SYSDRV LDX SYSDEV BNE DODIRTODIR LDY WRKDRV LDX WRKDEV; FALL THROUGH TO DODIRDODIR TXA PHA TYA ORA #'0 STA SDOLLAR+1 LDX #<SDOLLAR LDY #>SDOLLAR JSR STRLOAD LDA $29 CMP #$02 BNE T1260F LDX ARGV+2 LDY ARGV+3 JSR STRAPND JM
EQ T1440F SEC RTST1440F JSR CHRIN PHA JSR READST STA OREADST JSR STOP BNE T1445F INC OREADSTT1445F PLA CLC RTSOREADST = CHRRDST+1;; DODOS - DO USER SPECIFIED "DOS" COMMAND;DODOS JSR CHK2ARGS LDX ARGV+2 LDY ARGV+3 JSR STRLOAD;; SNDWRBL,X PHA ; PUSH PCL FOR RTS RTS ; INDIRECT JUMP (TO TABLE ENTRY, +1);; TABLE OF COMMAND NAMES;CMDTBL .BYTE "BYE",0,0 .BYTE "LOAD",0 .IFNE ,0 .BYTE "DIRS",0 .BYTE "DIR",0,0 .BYTE "DEL",0,0 .BYTE "REN",0,0 .BYTE "TYPE",0 .FI .BYTE RFPARGPRFNOTF CMP #'G BNE PRFNOTG JSR PRFG JMP PRFPARGPRFNOTG CMP #0 BEQ PRFNULB JSR PRFPFC JMP PRFMNLPPRFNULB DEY JMP PRFMNLPPRFNPER JSR PRFPFC JMP PRFMNLPPRFPFC STY $51 LDY $4D BEQ T0200F LDY $51 JMP CHROUTT0200F STA ($FB),Y INC $FB0PRFFLP LDA FLTBUF,Y BEQ T0400F CMP #$20 BEQ T0390F CMP #$45 BNE T0370F JSR PRFEXP LDA #0 STA $55 INC $53 LDA #$45T0370F STA $51 LDA $55 BEQ T0375F LDA $50 BEQ T0390F DEC $50T0375F LDA $51 CMP #$2E BNE T0380F LDA $56 BNE T0400F INC ($FD),Y CMP #$4C BNE T0590F INYT0590F RTSPRFGFLD LDA ($FD),Y CMP #'* BNE T0600F LDX $4C LDA ARGSTK,X INX INX STX $4C INY RTS;T0600F JMP PFGNUM ; AND RETURN;PRFPARG STX $54 LDA $4E BNE T0630F JSR PRFOUTT0630F LDX #0T0640F CPX $54 LDY $51 BNE T0240F EOR #$FF STA $5B LDA $5A EOR #$FF STA $5A INC $5A BNE T0230F INC $5BT0230F LDA #'- STA PRFBUF INC $54T0240F LDX #$04T0250B LDY #$00T0260B LDA $5A SEC SBC T0310F,X STA $51 LDA $5B SBC T0320F,X BCC T0270F STA $5B L0T0420B STA PRFBUF,X INX DEC $50 BNE T0420BT0430F RTSPRFX JSR PRFGARG LDX #0 LDA #4 STA  $5CT0440B LDA $5B LSR A LSR A LSR A LSR A TAY BNE T0450F LDA $58 BEQ T0460FT0450F LDA PRFHEXT,Y STA PRFBUF,X INX STX $58T0460F LDY #4T0470B AY TO (SMALL) NUMBER IN A;   USES $FD,$FE, $5A,$5B (AND Y AND A);GETNUM = * STX $FD STY $FE LDY #0;; PFGNUM - SPECIAL ENTRY FOR PRINTF USE ONLY;  ASSUMES $FD,$FE AND Y SET UP ALREADY;PFGNUM LDA #$00 STA $5AT0610B LDA ($FD),Y EOR #'0  ; ASSUM .BYTE $01,$0A,$64,$E8,$10 ; POWER TABLET0320F .BYTE $00,$00,$00,$03,$27 ; (1,10,100,1000,10000)PRFG LDA $1 ; SWITCH   IN PHA ORA #$01 STA $1 STY $4B CLC LDA #$3C ADC $4C LDY #$03 JSR $BBA2 ; CHANGE ./. TO FLOAT @$61 JSR $BDDD ; CHD #7 TAY  BNE T0500F LDA $58 BEQ T0510FT0500F LDA PRFHEXT,Y STA PRFBUF,X INX STX $58T0510F LDY #$03T0520B ASL $5A ROL $5B DEY BNE T0520B DEC $5C BNE T0490B JMP PRFNRTSPRFC LDX $4C LDA ARGSTK,X STA PRFBUF INX INX STX $4C LDX #1 RTS;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODE1 STA $1 STY $4B CLC LDA #$3C ADC $4C LDY #$03 JSR $BBA2 ; CHANGE ./. TO FLOAT @$61 JSR $BDDD ; CHANGE FLOAT @$61 TO  LDA #0 STA $56 STA $55 STA $53 LDA $50 BNE T0350F INC $56T0350F BPL T0360F LDA #6 STA $50T0360F LDY #0 LDX #ND STA $4E INY LDA ($FD),Y CMP #$2D BNE T0550F INC $4E INYT0550F LDA ($FD),Y CMP #$30 BEQ T0560F LDA #$20T0560F STA $52 JSR PRFGFLD STA $4F LDA ($FD),Y CMP #'. BNE T0570F INY JSR PRFGFLD JMP T0580FT0570F LDA #$FFT0580F STA $50 LDATHE SHELL TO;  OPERATE WITH THE  DISK;;; SRCHCMD.A - ROUTINES FOR SEARCHING;   FOR AND EXECUTING BUILT-IN COMMANDS;; SRCHCMD - LOOK FOR A BUILT-IN COMMAND;   EXECUTE IF FOUND;;; COLCMD - SET TO ZERO TO REMOVE 'COL';   SCREEN COLOUR COMMAND BNE T0210F INC $FCT0210F LDY $51 RTSPRFGARG STY $4B LDX $4C LDA ARGSTK,X STA $5A INX LDA ARGSTK,X STA $5B INX STX $4C LDA #$00 STA $58 RTSPRFU LDA #$01 BNE T0220FPRFD LDA #$00T0220F STA $51 JSR PRFGARG STA $54 LDA $5B BPL T0240F  $55T0380F LDA $51 STA PRFBUF,X INXT0390F INY JMP PRFFLPT0400F CLC LDA $4C ADC #5 STA $4C LDY $4B PLA STA $1PRFEXP LDA $56 BNE T0430F LDA $53 BNE T0430F LDA $55 BNE T0410F LDA #$2E STA PRFBUF,X INXT0410F LDA $50 BEQ T0430F LDA #$3BEQ T0650F LDA PRFBUF,X JSR PRFPFC INX BNE T0640FT0650F LDA $4E BEQ T0660F JSR PRFOUTT0660F JMP PRFMNLPPRFOUT SEC LDA $4F SBC $54 BCC T0680F TAX BEQ T0680FT0670F LDA $52 JSR PRFPFC DEX BNE T0670FT0680F RTS;;; GETNUM - TURN PTR IN X,DA $51 STA $5A INY BNE T0260BT0270F TYA BEQ T0280F STA  $58T0280F LDA $58 BEQ T0290F LDA PRFHEXT,Y LDY $54 STA PRFBUF,Y INC $54T0290F DEX BPL T0250B LDX $54PRFNRTS LDY $4B LDA $58 BNE T0300F LDA #'0 STA PRFBUF,X INXT0300F RTST0310FSL $5A ROL $5B DEY BNE T0470B DEC $5C BNE T0440B JMP PRFNRTSPRFHEXT .BYTE "0123456789ABCDEF"PRFO JSR PRFGARG LDX #0 LDA $5B BPL T0480F LDA #$31 STA PRFBUF INX STX $58T0480F LDA #$05 STA  $5CT0490B LDA $5B LSR A LSR A LSR A LSR A AN ES ASCII CMP #10 BCS T0620F STA $5B LDA $5A ASL $5A ASL $5A ADC $5A ASL A ADC $5B STA $5A INY BNE T0610BT0620F LDA $5A RTS$54 BCC T0680F TAX BEQ T0680FT0670F LDA $52 JSR PRFPFC DEX BNE T0670FT0680F RTS;;; GETNUM - TURN PTR IN X,	ANGE FLOAT @$61 TO  LDY #$00 LDX #$00PRFGLP LDA FLTBUF,Y BEQ T0340F CMP #$20 BEQ T0330F STA PRFBUF,X INXT0330F INY JMP PRFGLPT0340F CLC LDA $4C ADC #$05 STA $4C LDY $4B PLA STA $1 RTSPRFF LDA $1 ; SWITCH   IN PHA ORA #$0
PRFS STY $4B LDX $4C LDA ARGSTK,X STA $20 INX LDA ARGSTK,X STA $21 INX STX $4C LDY #0T0530B LDA $50 BEQ T0540F LDA ($20),Y BEQ T0540F STA PRFBUF,Y INY DEC $50 BNE T0530BT0540F TYA TAX LDY $4B RTSPRFPERC LDA #0 ; PRINTF, PERCENT FOU, AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER ;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODE;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODE	 $4C LDY #$FFPRFMNLP INY LDA ($FD),Y BNE T0190F LDY $4D BNE T0180F STA ($FB),YT0180F JMP CLRCHNT0190F CMP #'% BNE PRFNPER JSR PRFPERC LDA ($FD),Y CMP #'D BNE PRFNOTD JSR PRFD JMP PRFPARGPRFNOTD CMP #'U BNE PRFNOTU JSR PRFU JMP PRFPARGTED TO THESCREEN.HE USER MAY THEN HIT CARRIAGE RETURN MANUALLYAFTER THE AUTOMATIC EXECUTION HAS FINISHED..SPS A WORK AROUND TO THE 10LINE PROBLEM,NOTE THAT THERE IS NOTHING TO STOP ANEXEC SCRIPT FROM GENERATING OUTPUT WHICHDOES ANOTHER "EXEC"!THE SHELL TO;  OPERATE WITH THE  DISK;;; C$GETCHAR.A;;  HIS IMPLEMENTS THE  LIBRARY ROUTINES; C$FUNCTINIT AND C$GETCHAR;;  HEY MUST BE IN THE SHELL TO SAVE; SPACE.  T WOULD BE NICE TO BE ABLE TO; LINK IN THE VERSIONS FROM THE DISTRIBUTTHE SHELL TO;  OPERATE WITH THE  DISK;;; DPRINTF.A - PRINTF IMPLEMENTATION;   ROUTINES;;;  T MUST BE IN THE SHELL TO SAVE ; PROGRAM SIZE.  T WOULD BE NICE TO BE; ABLE TO LINK IN THE VERSION FROM THE; DISTRIBUTION LIBRARY DISK, BUT SEVERAHOULDN'T BE TOO DIFFICULT TOADD A ".ELSEIF" AS WELL, ALTHOUGH IT MIGHTBE OF LIMITED USE..SP THINK THE UTILITY IS TOO SLOW TO BEPLEASING TO 1541 USERS.ITH A FASTLOAD CARTRIDGE, PERHAPS ITWILL BE TOLERABLE.INCE  USE A  ISK IN A 1764, HOWEVE PAGE;; C$FUNCTINIT - DO C FUNCTION INIT;C$FUNCTINIT LDA $1A ; POP BYTE OFF  STACK BNE T0150F DEC $1BT0150F DEC $1A LDY #$00 LDA ($1A),Y TAX RTS;; C$GETCHAR - DO GETC FOR C;C$GETCHAR TAY DEY LDA FSTATBL,Y BEQ T0100F SEC RTST0100FFORCED ABOVE $1600 TO $16FF PAGE;             ; ALSO WE COMBINE WITH 'STRAC' TO SAVE SPACE;FLTBUF=$0100  ; BASIC ROUTINE FLOATING POINT CONVERSION BUFFER;             ;  LIVES IN THIS PRECARIOUS PLACE!;DSPRINT JSR C$FUNCTINIT  ; SPRINTF LDA ARGST PRFNOTU CMP #'X BNE PRFNOTX JSR PRFX JMP PRFPARGPRFNOTX CMP #'O BNE PRFNOTO JSR PRFO JMP PRFPARGPRFNOTO CMP #'C BNE PRFNOTC JSR PRFC JMP PRFPARGPRFNOTC CMP #'S BNE PRFNOTS JSR PRFS JMP PRFPARGPRFNOTS CMP #'F BNE PRFNOTF JSR PRFF JMP P UT STY CGETLIM STY CGETCNT LDA CGETCBF CMP #'. BNE T0130F LDA CGETCBF+1 CMP #$0D BNE T0130FVCGETFN LDY #0 ; SELF MODIFY LDA #$01 ; MARK  STA FSTATBL,Y SEC RTST0130F LDX #0 STX CGETCNTT0140F LDA CGETCBF,X INC CGETCNT CLC RTSST0100F0160F CMP #2 BNE T0170FT0165F LDX STDOUFL BNE T0170F JSR CLRCHN JMP EPRINTFT0170F TAX JSR CHKOUTEPRINTF LDA #$01ESPRINT STA $4D ; FLAG; 0 MEANS SPRINTF LDX $4C LDA ARGSTK,X INX STA $FD ; FMT STR ADDR IN FD,FE LDA ARGSTK,X INX STA $FE STXNE)IS NOT APPLIED INDIVIDUALLYFOR EACH .EXEC'D SUB-FILE, EITHER.ERHAPS THE BLANK/NON-BLANK LINE DEFAULTRULE IS NOT REALLY VERY GOOD..SPO MORE THAN 10 LINES OF INPUT CAN BE GENERATEDAS THE RESULT OF ONE EXEC FILE.OTE THAT MORE LINES CAN BE PRIN, AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER , AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER !!.SP'EXEC' DOES NOT INFORM THE USERWHEN TOO MANY LINES HAVE BEEN OUTPUT TOTHE SCREEN.ORSE, IT WILL TRY AND CURSOR UP PAST THETOP OF THE SCREEN TO READ INPUT FROMTHERE!.SPERHAPS .IF/.FI SHOULD BE USED, TO ALLOWMORE ERROR DETECTION.LSO, IT SION; LIBRARY DISK, BUT SEVERAL PROBLEMS; PREVENT THIS, SO THESE VERSIONS ARE; PROVIDED HERE.; .REF FSTATBL,CGETCNT,CGETLIM; .REF READST,CHRIN,CHROUT;  .DEF C$FUNCTINIT,C$GETCHAR; .REF CGETCBF  ; MUST BE FORCED ABOVE THE $1600 TO $16FF ADDRESSL; PROBLEMS PREVENT THIS, SO THIS VERSION; IS PROVIDED HERE.;;  ALSO GETNUM ROUTINE USED BY SHELL; .REF STDOUFL; .REF ARGSTK; .REF CHKOUT,CLRCHN,CHROUT; .DEF DPRINTF,DSPRINT,DFPRINT; .DEF GETNUM; .REF C$FUNCTINIT .REF PRFBUF  ; MUST BE  HR, FIND  USE SOME QUITE FRIVOLOUS "EXEC"COMMANDS QUITE FREQUENTLY.TPUT TOTHE SCREEN.ORSE, IT WILL TRY AND CURSOR UP PAST THETOP OF THE SCREEN TO READ INPUT FROMTHERE!.SPERHAPS .IF/.FI SHOULD BE USED, TO ALLOWMORE ERROR DETECTION.LSO, IT S
 LDA $99 BEQ T0110F JSR CHRIN ; GET FROM OTHER THAN KEYS PHA JSR READST STA FSTATBL,Y PLA CLC RTST0110F LDX CGETCNT ; GET FROM KEYS CPX CGETLIM BNE T0140F STY VCGETFN+1 TAYT0120B JSR CHRIN STA CGETCBF,Y INY CMP #$0D BNE T0120B JSR CHROK,X STA $FB ; PTR TO OUTPUT STR IN FB,FC INX LDA ARGSTK,X STA $FC INX STX $4C LDA #$00 JMP ESPRINT;DPRINTF JSR C$FUNCTINIT  ; PRINTF STX $4C LDA #2 ; STDOUT BNE T0165F;DFPRINT JSR C$FUNCTINIT  ; FPRINTF LDA ARGSTK,X INX INX STX $4CTECIFIED, THE CURSORSTILL MOVES UP THE SCREEN..SPHEN "-R" IS SPECIFIED, BUT THERE ARE NO'\R' ESCAPES IN THE INPUT FILE, IDEALLY YOUMIGHT WANT '\R'S GENERATED IN THE OUTPUT ANYWAY..SPHE '\R' RULE (DEFAULTING TO ONECARRIAGE RETURN PER NON-BLANK LIFILE..SPNY LINE ON WHICH THE FIRST NON-BLANKCHARACTER IS A SEMICOLON (';')IS TREATED AS A COMMENT,AND WILL NOT BE TRANSFERRED TO THE STANDARDOUTPUT..SP.NE 18EVERAL CONTROL COMMAND LINES ARE RECOGNIZED.LL OF THESE HAVE A "." AS THE FIRSTNON-TO THE MATCHING ".END" WILL BEIGNORED (WITH THE ADDITIONAL PROVISOTHAT THE ".ELSE" MUST PROPERLY CORRESPOND TOA ".IF")..SP.NE 12YNTAX FOR .IF/.ELSE IS:.SP.NF.IN +5 .IF   ... BALANCED LINES ... .ELSE   ... BALANCED LINES ... .END.SP.IN -5HESCREEN ARRANGEMENT WHEN THE VARIOUSPROGRAMS (INCLUDING THE OWER  HELL)WILL REQUIRE INPUT.  LANK LINES MUSTBE LEFT TO PROVIDE ROOM FOR OUTPUT..SPHE CONCEPTS OF WORKING WITH 'EXEC'ARE BEST LEARNED BY LOOKING AT EXAMPLES..SP.NE 10.SPMALLY BE INCONSEQUENTIAL, BUTNOTE IT AS A CAVEAT..SPHE .ERROR COMMAND TRANSFERS THE REST OFTHE LINE TO THE STANDARD OUTPUT, AND THENCAUSES ALL FURTHER PROCESSING OF THE FILETO CEASE..SPHE .IN COMMAND IS USED TO CONTROL THE INDENTATIONOF THE LITHE MATCHING".END" WILL BE PROCESSEDUNTIL REST OF THE LINE CONTAINING ".WHILE"IS BLANK.  HIS IMPLIES THERE MUST BE SOME WAYOF CHANGING THAT.EE ".SHIFT"..SPHE .SHIFT COMMAND MOVES ALL COMMAND LINEARGUMENTS LEFT BY ONE, SORT OF.HAT IS, WHAT WAULD TOO EASILYCLOSE THE SCRIPT INPUT FILE.NE SOLUTION MIGHT BE TO REQUIRE SCRIPT FILESTO BE ON A COMPLETELY SEPARATE DEVICE WHICHWAS NEITHER WORK NOR SYS.NOTHER WOULD BE TO KEEP CLOSING ANDRE-OPENING THE FILE, SKIPPING LINES OFINPUT FOR EACH ANDOWINGTHE ".IN" WILL BE DISCARDED, AND THE REST OF THE LINEWILL BE OUTPUT AS IT IS.F "-R" HAS BEEN SPECIFIED, THE ENTIRE LINE, INCLUDINGTHE ".IN" WILL BE TRANSFERRED, SO THAT THE ".IN"CAN BE PROCESSED IF THE OUTPUT IS PROCESSEDAS AN 'EXEC' FILE..SOF THE .SHIFT LINE IS IGNORED..SPHE .PUSHARG AND .POPARG COMMANDS CAN BEUSED TO "REMEMBER" THE ".SHIFT" STATE.HEN A .PUSHARG LINE IS ENCOUNTERED,THE VALUES FOR '\0', '\1'... ARE PUSHEDONTO A STACK.HEN A .POPARG LINE IS ENCOUNTERED,THE VALUES P UFFERED INITIALLY, SOWHILES DON'T HAVE TO RE-OPEN IT..SPF STANDARD OUTPUT IS REDIRECTED, BUT NO-N OR -R OPTION IS SPECIFIED,THE CURSOR STILL MOVES UP THE SCREEN, ANDCOMMAND LINES WILL BE READ FROM WHERE ITENDS UP..SPVEN WHEN "-N" OR "-R" IS SP OUTPUT.N PARTICULAR, A DOUBLE BACKSLASH,("\\"), WILL GENERATE A SINGLE ONE INTHE OUTPUT.F "-R" HAS BEEN SPECIFIED, BOTH THE BACKSLASH ANDTHE CHARACTER WILL BE TRANSFERRED TO THEOUTPUT,SO THEY CAN BE PROCESSED IF THE RESULTIS USED AS AN 'EXEC' LINE.F THE LINE WAS BLANK, ALL LINES UP TOTHE MATCHING ".END" OR ".ELSE" WILL BEIGNORED.F A ".ELSE" IS FOUND IN THIS CASE, THE LINESFROM THE ".ELSE" TO THE MATCHING ".END" WILL BEPROCESSED..SPF A ".ELSE" IS ENCOUNTERED OTHERWISE,ALL LINES UP NDANT ONES HAVE NO EFFECT..SPHE .EXEC COMMANDCAN REFERENCE ANY EXEC FILEWHICH COULD BE RUN DIRECTLY BY THE'EXEC' COMMAND, BUT EXPANDS THECONTENTS OF THE FILE IMMEDIATELY,PROVIDING A SORT OF "MACRO" FACILITY..SPHE COMMAND FILE MUST ANTICIPATE TBLANK CHARACTER ON THE LINE.N SUMMARY, THEY ARE:.SP.NF.IN +5 .ERROR .IN .IF .ELSE .WHILE .END .SHIFT .PUSHARG .POPARG .EXEC.IN -5.FI.SPHE SEMICOLON OR DOT KEYWORD IS TESTEDFOR  BACKSLASH SUBSTITUTION HAS BEENDONE.HIS WILL NOROR:.SP.IN +5 .IF   ... BALANCED LINES ... .END.IN -5.FI.SPHIS IS LIKE THE SYNTAX FOR #IFDEF, ETC.IN THE  PREPROCESSOR.HERE IS NO "HANGING ELSE" PROBLEM AS IN AND OTHER LANGUAGES..SP .WHILE IS SIMILAR TO THE ".IF", BUTTHELINES UP TO NTICIPATING THE OUTPUT OF PROGRAMS IS ANUISANCE.NE MIGHT LIKE TO HAVE THE OWER  HELLPROCESS "PROPER" SCRIPT FILES, BUTTHE NATURE OF OMMODORE ISK RIVES IS SUCHTHAT ANYONE CLOSING A COMMAND CHANNEL, OREVEN JUST SENDING AN "I" COMMAND TO IT, CONE.ORMALLY, ALL BLANKS AT THE BEGINNING OF EACH LINEARE REMOVED, AND EXACTLY TWO BLANKS ARE ADDED TOALLOW FOR THE STANDARD OWER  HELL PROMPT.HIS ALLOWS INPUT TO BE INDENTED IN A STRUCTUREDFASHION.OR A .IN LINE, HOWEVER, EXACTLY ONE BLANK FOLLS '\0' BECOMES '\1',WHAT WAS '\2' BECOMES '\1', AND SO-ON.N FACT, IF THERE WERE MORE THAN 10 ARGUMENTS,THE ELEVENTH ONE BECOMES AVAILABLE AS THENEW TENTH ONE, '\9'!HIS ALLOWS ONE TO DO THE SAME THING TOEACH OF THE ARGUMENTS IN THE LIST.HE REST 	 EVERY OWER  COMMAND, BUTTHIS WOULD BE TOO SLOW..SPUT 'EXEC' IS AMODERATELY ELEGANT SOLUTION WHICH DOES NOTREQUIRE MODIFICATION OF THE OWER  HELL ASDISTRIBUTED..SPPEAKING OF CLOSING AND RE-OPENING FILES, PERHAPSTHE ENTIRE FILE SHOULD BE BPHE .IF ALLOWS VERY LIMITED FLOW CONTROL.  HELINES CONTROLLED BY THE .IF WILL BE OUTPUT ONLYIF THE REST OF THE LINE CONTAINING THE ".IF" IS NOTCOMPLETELY BLANK.SUALLY, THIS IS USED TO TEST WHETHER APARTICULAR ARGUMENT WAS PRESENT ON THE COMMAND USHED BY THEMOST RECENT ".PUSHARG",ARE "POPPED" OFF THE STACK,AND USED TO REPLACE THE CURRENT VALUESFOR '\0', '\1', ETC.HIS IS USEFUL IF YOU WISH TO RUN THROUGHTHE LIST OF ARGUMENTS SEVERAL TIMES.F MORE .POPARGS THAN .PUSHARGS ARE DONE, THEREDU ~;; ED.E;  BY USING THIS EXEC FILE, IT IS EASY;  TO KEEP A BACKUP OF THINGS YOU ARE;  EDITING;.EXEC MVOLD \1ED \1OLD\R   TEXEC2.E            LINK.E            WORKSYS.E            MVOLD.E          ;; ARCH.E - ARCHIVE FROM RAMDISK (#9);   TO WORK DRIVE, (#8);; TWINCOPY IS A PROGRAM THAT TAKES ALL;  OF ITS ARGUMENTS AS FILES TO COPY;  FROM THE CURRENT SYS DEVICE TO THE;  CURRENT WORK DRIVE;; NOTE HOW ARCH.E ALLOWS MULTIPLE;  ARGUMENTS BY E;; BAR.E;;  HIS FILE IS FOR USE WITH THE;    DISK.;  T JUST ARRANGES THAT THE FILE AT;   THE BOTTOM OF THE DIRECTORY LISTING;   FOR THE  DISK WILL BE;   "----------------" (MY STARTUP;    DISK LOAD ARRANGES TO PLACE;   THIS FILE AT T;; READREC.E;;  HIS FILE JUST USES MY 'PEEK' UTILITY;  (AVAILABLE IN PEEKPOKE.ARC) TO;  EXAMINE THE CURRENT STATE OF THE;  1764  XPANSION ONTROLLER ();  (IF YOU HAVE ONE, OF COURSE);;PEEK $DF00 $DF01 $DF02 $DF03 $DF04 $DF05 $DF06 $DF07(DEPTH == 1)        DEPTH = 0;        RETURN TYPE;  /* TOKEN WHICH EMPTIED DEPTH */RELINE(NUMBER, E)UNSIGNED NUMBER; *E;  AUTO CHAR TMPBUF[];  IF (NUMBER <= E->EINLINNO)     /* SHOULD ALWAYS BE THE CASE */    FCLOSE(E- LES;   ALWAYS APPEAR LAST, EVEN IF FILES;   HAVE BEEN PREVIOUSLY SCRATCHED.;;MV ---------------- ---------------1\RDISK C0:----------------=---------------1\RRM ---------------1\R01 ....RTUP;    DISK LOAD ARRANGES TO PLACE;   THIS FILE AT T.RM 70.IN 10.SP.SP.TI +5EXEC - EXECUTE A FILE OF OWER  HELL COMMANDS.BR.TI +10FOR THE OMMODORE 64.SP.SP.TI +5EXEC [-NR] COMMANDNAME [ARGS...].SP.SP'EXEC'SEARCHES THE WORK DISK FOR A SEQUENTIAL FILE NAMED"COM )    ++E->EINLINNO;0;        RETURN TYPE;  /* TOKEN WHICH EMPTIED DEPTH */RELINE(NUMBER, E)UNSIGNED NUMBER; *E;  AUTO CHAR TMPBUF[];  IF (NUMBER <= E->EINLINNO)     /* SHOULD ALWAYS BE THE CASE */    FCLOSE(E-E LINES.HEREFORE, THIS ALLOWS A SOMEWHAT LIMITED"BATCH", OR "SCRIPT" FILE FACILITY..SPHE OPTIONAL EXTRA COMMAND LINEARGUMENTS CAN BE USEDTO PARAMETERIZE THE SCRIPT..SPHE '-N' OPTION WILL PRINT THE LINES BUTARRANGE THAT NO INPUT WILL BE READ FF CARRIAGE-RETURNS FROM THE KEYBOARD,SO THAT THE LINES IT HAS DISPLAYED ONTHE SCREEN WILL BE USED AS INPUT..SPHE OWER  HELL CAN READ THESE LINES,OR, IN SOME CASES, THE PROGRAMS THEYCAUSE TO EXECUTE (FOR EXAMPLE, THE LINKER),CAN READ SOME OF THS RECOGNIZEDAS SPECIAL BY 'EXEC'.F A LINE CONTAINS "\R", THIS SIGNIFIESTHAT IT WILL REQUIRE A CARRIAGE RETURNTO CAUSE IT TO BE PROCESSED AS INPUT.F NO "\R" SEQUENCES ARE FOUND, HOWEVER,THE RULE IS THAT ONE CARRIAGE-RETURN WILLBE GENERATED FOR EA
E..SPT HAS BEEN ARBITRARILY DECIDED TO USE A ".E"SUFFIX FOR FILES TO BE USED WITH 'EXEC', TOALLOW THEM TO BE IDENTIFIED.OTE THAT THIS SUFFIX MUST NOT BE SPECIFIEDON THE COMMAND LINE, HOWEVER..SP.NE 10.SPHE BACKSLASH CHARACTER ('\') ICH NON-BLANK LINE OUTPUT.(HE BLANK LINES OUTPUT, THEN, ARE CONSIDERED TOBE PLACEHOLDERS FOR OUTPUT GENERATED BYTHE PROGRAMS INVOKED)..SPACKSLASH FOLLOWED BY A DIGIT IS TAKEN TOREPRESENT AN ARGUMENT FROM THE COMMAND LINE.HE "COMMANDNAME" IS "\0" XECING ITSELF UNTIL;  THERE ARE NO MORE ARGUMENTS LEFT;WORK 8 0\RSYS 9 0\R.SHIFT.IF \0  .EXEC MVOLD \0  TWINCOPY \0\R  .SHIFT.ENDWORK 9 0\R.IF \0  ; EXEC NOT .EXEC!  EXEC ARCH \*\R.ENDYS.E            MVOLD.E          HE BOTTOM OF THE;   DIRECTORY INITIALLY.;;  HIS IS USEFUL TO HELP YOU REMEMBER;   WHAT YOU HAVE AND HAVEN'T ARCHIVED;   TO REAL DISKS!;;  T WORKS BECAUSE THE  DISK DOES;   NOT LEAVE "HOLES" IN ITS DIRECTORY,;   BUT INSTEAD, NEWLY CREATED FI  $DF08 $DF09 $DF0A;;  OTE THAT THIS OFTEN DOESN'T TELL YOU;   MUCH, SINCE USUALLY THE REGISTERS;   ARE SET FROM LOADING 'PEEK'!;C2.E            LINK.E            WORKSYS.E            MVOLD.E          >EFID);    IF ((E->EFID = FOPEN(E->ENAME, "R")) == 0       FERROR())       PRINTF("PANIC: CAN'T OPEN %S\N",E->ENAME);      EXIT(1);        E->EINLINNO = 0;    WHILE (E->EINLINNO < (NUMBER-1) &&    FGETS(TMPBUF, , E->EFID) != , THE NEXT ONE IS"\1", AND SO-ON.  EE ALSO, HOWEVER,".SHIFT", ".PUSHARG", AND ".POPARG".F THE DIGIT EXCEEDS THENUMBER OF ARGUMENTS GIVEN, THE SEQUENCE EXPANDSTO NOTHING, AS WOULD BE EXPECTED..SPHE SEQUENCE "\*" (BACKSLASH FOLLOWED BYASTERISK) 	MANDNAME.E", AND COPIES ITS CONTENTS,AFTER SOME PROCESSING,TO THE STANDARD OUTPUT, WHICH SHOULDNORMALLY BE THE SCREEN.EFORE'EXEC'EXITS, IT MOVES THE CURSOR UP THESCREEN, AND ARRANGES THAT THE OMMODORE64 KERNAL WILL "SEE" AN APPROPRIATE NUMBERO
EXPANDS INTO ALL THE ARGUMENTS FROMTHE FIRST ('\0') ON, ALL SEPARATED BY A SINGLEBLANK.  OTE THAT "\*" IS ALSO MODIFIED BY".SHIFT", ".POPARG", AND ".PUSHARG"..SPACKSLASH FOLLOWED BY ANY OTHERCHARACTERCAUSES THE CHARACTER TO BE TRANSFERRED TOTHEROMTHE SCREEN..SPHE '-R' OPTION WILL ALSO ARRANGE THAT NO INPUT WILL BE READ FROMTHE SCREEN, BUT IN ADDITION IT WILL TRANSFER MOST'\' ESCAPES(QV) TO THE OUTPUT.  HIS ISINTENDED TO ALLOW ONE TO GENERATE A SPECIFICSCRIPT FILE FROM A GENERALIZED ONEARGV = A->AARGV;      E->EARGC = A->AARGC;        BREAK;  CASE :    /* DO NOTHING */;    RETURN ;/* * SUBEXEC - INTERPRET LINE AS AN EXEC *  OF A SUBFILE */SUBEXEC(B, E)CHAR *B;  /* NOTE CHARS AT B ARE ALTERED */REGISTERNIT STRUCTS */  FOR ( ; T->TSTR != ; ++T)    IF (STRCMP(T->TSTR, TOKEN) == 0)      BREAK;  RETURN T->TTYPE;SKIPEND(E) *E;  REGISTER  DEPTH;  REGISTER  TYPE;  AUTO CHAR TMPBUF[];  DEPTH = 1;  TYPE = ; (*Q == '\N')      ++Q;  /* DELETE */    ELSE IF (*Q != '\\')      *P++ = *Q++;    ELSE       /* PROCESS BACKSLASH ESCAPES */      C = *++Q;      IF ('0' <= C && C < '9')         N = C - '0';        IF (N < ARGC)           STRCPY(P, ARGV[N]);   /* LEAVE  STACKED, TO BE ED */        IF (TYPE != )          EXECLN(BADELSE, E);            ELSE        EXECLN(NOEND, E);    BREAK;  CASE :    IF (E->EWSP > 0)       W = &E->EWSTACK[E->EWSP-1];      IF (W->WTYPE != )     ->ENCRIN;  E->EGO = EXP->EGO;/* * PRSARGS - PARSE A LINE INTO ARGC *   AND ARGV[] * * OTE THAT '\0'S ARE INSERTED INTO *  LINE */PRSARGS(LINE, ARGV)CHAR *LINE;CHAR **ARGV;  /* PLACE POINTERS TO ARG INTO HERE */  REGISTER UNSIGNED ARG WILL BE OVERWRITTEN */            ELSE         IF (RFLAG)   /* ALLOW THESE ESCAPES TO EXPAND AGAIN */          /* IS THIS THE RIGHT PLACE TO DO THIS? */          *P++ = '\\';          *P++ = C;                ELSE IF (*Q == 'R')          ++>WTYPE == )        RELINE(W->WLINNO,E);        BREAK;  CASE :    IF (E->EARGC > 0)       --E->EARGC;      ++E->EARGV;        BREAK;  CASE :    PRINTF("%S\N", B);    E->EGO = ;    BREAK;  CASE :    IF (RFLAG)          ++P;              ELSE       *ARGV++ = P;      WHILE (*P != ' ' && *P != '\0')        ++P;        IF (*P != '\0') *P++ = '\0';  STRUCT TOKTBL   CHAR *TSTR;  UNSIGNED TTYPE;;CHAR *TOKTBL[] =   "ELSE", ,  "END", ,DEFINE  3#DEFINE  4#DEFINE  5#DEFINE  6#DEFINE  7#DEFINE  8#DEFINE  9#DEFINE  10#DEFINE  11SPECIAL(BUF, E)CHAR *BUF; *E;  AUTO CHAR *BP;  /* NEED TO TAKE & */  REGISTER CHAR *B;  REGISTER  F (E->EASP < )       A = &E->EASTACK[E->EASP];      A->AARGV = E->EARGV;      A->AARGC = E->EARGC;      ++E->EASP;        BREAK;  CASE :    IF (E->EASP > 0)       --E->EASP;      A = &E->EASTACK[E->EASP];      E->*B == ' ') ++B;  IF (*B == ';') RETURN ;  IF (*B != '.') RETURN ;  ++B;  FOR (P = TOKEN; ('A' <= *B && *B <= 'Z') && P-TOKEN < 8; )    *P++ = *B++;  *P = '\0';  *PB = B;  T = (STRUCT TOKTBL*)TOKTBL;  /* KLUDGE BECAUSE  OWER  WON'T ISE :    WHILE (*B == ' ') ++B;    W = &E->EWSTACK[E->EWSP];    W->WTYPE = TYPE;    W->WLINNO = E->EINLINNO;    ++E->EWSP;    IF (*B == '\0')      IF ((ETYPE = SKIPEND(E)) == )        --E->EWSP;      ELSE IF (ETYPE == )        *E;  UNSIGNED ARGC;  REGISTER  *EXP;  AUTO CHAR *ARGV[40];  AUTO  EX;    ARGC = PRSARGS(B, ARGV);  EXP = &EX;  EXEC(ARGC, ARGV, EXP);  E->ENLINOUT += EXP->ENLINOUT;  E->ENNBLOUT += EXP->ENNBLOUT;  E->ENCRIN += EXP WHILE (DEPTH > 0 &&    FGETS(TMPBUF, , E->EFID) != )     ++E->EINLINNO;    SWITCH (TYPE = GETTOK(TMPBUF))        CASE :    CASE :      ++DEPTH;      BREAK;    CASE :      --DEPTH;      BREAK;    CASE :      IF           WHILE (*P != '\0') ++P;                    ELSE IF (*Q == '*')         --P;        FOR (N = 0; N < ARGC; ++N)           STRCPY(++P, ARGV[N]);          WHILE (*P != '\0') ++P;          *P = ' ';                /* NOTE, LAST BLANK   EXECLN(BADELSE, E);      ELSE IF(SKIPEND(E) != )        EXECLN(NOEND, E);      ELSE        --E->EWSP; /* OKAY, REMOVE ELSE */        BREAK;  CASE :    IF (E->EWSP > 0)       --E->EWSP;      W = &E->EWSTACK[E->EWSP];      IF (W-C;  REGISTER CHAR *P;  FOR (P = LINE, ARGC = 0; ; ++ARGC)     WHILE (*P == ' ') ++P;    IF (*P == '\0') RETURN ARGC;    IF (*P == '"')       *ARGV++ = ++P;      WHILE (*P != '\0' && *P != '"')         IF (*P == '\\' && *(P+1) != '\0') ++P;  NCRIN;        ELSE  /* UNKNOWN CHAR, JUST REMOVE BACKSLASH */          *P++ = C;  /* USEFUL TO GET A BACKSLASH INTO THE OUTPUT */            IF (C != '\0') ++Q;        *P = '\0';  RETURN NCRIN;#DEFINE  0#DEFINE  1#DEFINE  2#	/* CAUSE LINE TO BE OUTPUT */      RETURN ;  /* SO RESULT CAN BE EXEC'D */    IF (*B != '\0') ++B;    PUTOUT(B, 0, E);    BREAK;  CASE :    /* CALL EXEC SUBFILE */    WHILE (*B == ' ') ++B;    SUBEXEC(B, E);    BREAK;  CASE :    I
  "ERROR", ,  "IF", ,  "SHIFT", ,  "WHILE", ,  "IN", ,  "EXEC", ,  "PUSHARG", ,  "POPARG", ,  , ;GETTOK(B, PB)CHAR *B;CHAR **PB;  STATIC CHAR TOKEN[10];  CHAR *P;  STRUCT TOKTBL *T;  WHILE ( *W;  REGISTER  *A;   TYPE, ETYPE;  STATIC CHAR *BADELSE = ".ERROR ELSE WITHOUT END";  STATIC CHAR *NOEND = ".ERROR END NOT FOUND";  TYPE = GETTOK(BUF, &BP);  B = BP;  SWITCH (TYPE)    CASE :    RETURN ;  CASE :  CA#INCLUDE <STDIO.H>#DEFINE  1#DEFINE  0#DEFINE  90TYPEDEF CHAR ;TYPEDEF CHAR ;/* * EXEC.C - SIMPLE-MINDED, AND KLUDGEY *  "COMMAND FILE PROCESSOR" FOR OWER *   ENVIRONMENT ON THE OMMODORE 64 * *  UTHOR: DRIAN EPPEAR **ARGV;  CHAR *P;  /*   * GLOBALS MUST BE RE-INITED IN CASE   *   WE WERE PRELOADED   */  DONTEX = ;  RFLAG = ;  ARGV = *PARGV;  ++ARGV;  --ARGC;  WHILE (ARGC > 0 && **ARGV == '-')     P = *ARGV;    WHILE(*++P != '\0')       SWITCXPAND(E->EOUTBUF, LINE, E->EARGC, E->EARGV);  IF (!SPECIAL(E->EOUTBUF, E))    PUTOUT(E->EOUTBUF, 2, E);  /* ELSE WORK HAS BEEN DONE *//* * PUTOUT - OUTPUT A LINE * *   COUNT NUMBER OF LINES OUTPUT *   COUNT NON-BLANK LINES * * REALLY, H*    OR 41 WEREN'T COUNTED PROPERLY *   AR 2, 1988 - ALSO, CHANGED EXEC() *    TO SEARCH SYSDEV AS WELL AS WRKDEV *    FOR EXEC FILE * */#DEFINE  20TYPEDEF STRUCT WSTACK   UNSIGNED WLINNO;   WTYPE; ;#DEFINE  EXEC(NARGS, ARGS, E)UNSIGNED NARGS;CHAR **ARGS; *E;  REGISTER CHAR *NAME;  AUTO CHAR INBUF[];  IF (E !=  && NARGS >= 1)     E->EARGC = NARGS;    E->EARGV = ARGS;    E->EINLINNO = 0;    E->EWSP = 0;    E->EASP = 0; OUT;  WHILE (*LINE == ' ')    ++LINE;  IF (*LINE != '\0')    ++E->ENNBLOUT;/* * STUFFKB - ARRANGE THAT KERNAL SEES *  APPROPRIATE LINES OF INPUT BY *  CURSORING UP ON THE SCREEN, AND *  STUFFING THE KEYBOARD BUFFER WITH *  CARRIAGE RETURNS, EASP;  CHAR ENAME[22];  CHAR EOUTBUF[90];   EWSTACK[];   EASTACK[]; ; DONTEX; RFLAG;#DEFINE SYSDEV (*((CHAR *)0X17FA))#DEFINE WRKDEV (*((CHAR *)0X17FC))MAIN(ARGC,AV)UNSIGNED ARGC;CHAR *        FERROR() == 0)        ;  /* FILE OPENED ALRIGHT */      ELSE         DEVICE(SYSDEV);        IF (SYSDEV != WRKDEV &&          (E->EFID = FOPEN(NAME, "R")) != 0 &&          FERROR() == 0)          ;  /* FILE OPENED ALRIGHT */        ELSENED I;  KEYBNDX = 0;  FOR (I = 0; I < NLINES; ++I)    PRINTF("%C", 0X91);  /* CURSOR UP */  FOR (I = 0; I < KEYBMAX; ++I)    KEYBUF[I] = 0X0D;  /* KERNAL IDEA OF CARRIAGE RETURN */  IF (NRETURNS > KEYBMAX)    NRETURNS = KEYBMAX;  KEYBNDX = NRETUC,ARGV, EXP);  IF (EXP->EGO ==   DONTEX  RFLAG)    NSTUFF = 0;  ELSE IF (EXP->ENCRIN == 0)    NSTUFF = EXP->ENNBLOUT;  ELSE    NSTUFF = EXP->ENCRIN;  STUFFKB(EXP->ENLINOUT, NSTUFF);OPTION(ARGC, PARGV)INT ARGC;CHAR ***PARGV;  CH\N", E);/* * EXECLN - EXECUTE A SINGLE LINE OF *  EXEC INPUT;  USEFUL FOR OUTPUTING *  OUR ERROR MESSAGES! */EXECLN(LINE, E)CHAR *LINE; *E;  IF (E == )     PRINTF("PANIC:  EXECENV\N");    EXIT(1);    E->ENCRIN +=    EF;CHAR *INBUF;INT ARGC;CHAR **ARGV;  REGISTER CHAR *P, *Q;  REGISTER CHAR C;  REGISTER UNSIGNED N;  UNSIGNED NCRIN;  NCRIN = 0;  P = OUTBUF;  Q = INBUF;  WHILE (*Q == ' ')  /* IGNORE LEADING BLANKS */    ++Q;  WHILE (*Q != '\0')     IF R *  ATE: ECEMBER 31, 1987 * *  LACED IN THE PUBLIC DOMAIN BY *   UPLOADING TO RO-INE OWER   *   (416)-276-6811, ANUARY 1988 * *  ODIFICATION HISTORY: *   AR 2, 1988 - TO FIX BUG IN PUTOUT() *    WHERE LINES GENERATED OF LENGTH 40 H (*P)            CASE 'N':        DONTEX = ;        BREAK;      CASE 'R':        RFLAG = ;        BREAK;      DEFAULT:        *PARGV = ARGV;        RETURN 0;               --ARGC;    ++ARGV;    *PARGV = ARGV;  RETURN ARGC;ERE WE SHOULD BE ABLE TO *  SUFFIX LINE WITH "\\R"S IF APPROPRIATE */PUTOUT(LINE, INDENT, E)CHAR *LINE;UNSIGNED INDENT; *E;  PRINTF("%*.*S%S\N", INDENT, INDENT, "", LINE);  ++E->ENLINOUT;  IF (STRLEN(LINE)+INDENT >= 40)    ++E->ENLIN20TYPEDEF STRUCT ASTACK   CHAR **AARGV;   AARGC; ;TYPEDEF STRUCT EXECENV   CHAR **EARGV;  UNSIGNED EARGC;  UNSIGNED EINLINNO;   EFID;   EGO;   ENLINOUT;   ENNBLOUT;   ENCRIN;   EWSP;     E->ENLINOUT = 0;    E->ENNBLOUT = 0;    E->ENCRIN = 0;    E->EGO = ;    IF (NARGS >= 1)       NAME = E->ENAME;      STRNCPY(NAME,ARGS[0],18);      STRCAT(NAME,".E");      DEVICE(WRKDEV);      IF ((E->EFID = FOPEN(NAME, "R")) != 0 && AND THE KEYBOARD *  LENGTH WITH THE APPROPRIATE NUMBER */#DEFINE KEYBUF ((CHAR *)0X0277)  /* SEE 64  */#DEFINE KEYBMAX (*((CHAR *)0X0289))#DEFINE KEYBNDX (*((CHAR *)0X0C6))STUFFKB(NLINES, NRETURNS)UNSIGNED NLINES, NRETURNS;  REGISTER UNSIG	*AV;  AUTO CHAR **ARGV;  REGISTER UNSIGNED NSTUFF;  REGISTER  *EXP;  AUTO  EX;  ARGV = AV;  ARGC = OPTION(ARGC, &ARGV);  IF (ARGC < 1)     PRINTF("USAGE:EXEC [-N] EXECFILE [ARGS ...]\N");    EXIT(1);    EXP = &EX;  EXEC(ARG
          EXECLN(".ERROR CAN'T OPEN \\0.E", E);              WHILE (E->EGO &&      FGETS(INBUF, , E->EFID) != )       ++E->EINLINNO;      EXECLN(INBUF, E);        FCLOSE(E->EFID);    ELSE    EXECLN(".ERROR NO ARGS TO EXECRNS;/* * EXPAND - PRINCIPALLY, CHANGE "\<DIG>" TO ARG * *  ALSO, COUNT \R'S TO STUFF KEYBOARD BUFFER COUNT *   (REALLY, \R PROCESSING SHOULD BE DONE ON OUTPUT?) * *  ALSO REMOVE '\N' TO SIMPLIFY */EXPAND(OUTBUF, INBUF, ARGC, ARGV)CHAR *OUTBUA                                     l                                     ADRIAN PEPPERAP2A                                                                                      ----------------                    EXEC                    ----------------              EXEC.C         -    TINYEXEC.C            DEARC.E            TEXEC1.E            TEXEC2.E          KKLINK.E            WORKSYS.E            MVOLD.E             ED.E            ARCH.E            BAR.E            READREC.E            EXEC.FMT         $ KK
 EXEC.EDME             ----------------                  NEWSHELL              ----------------             SHELLMAIN.A         &    C$GETCHAR.A            DPRINTF.A             DOLOAD.A          KKSRCHCMD.A         $    SHELLSTR.A            SHELLCENV.A            C64KERNAL.A            SHELLVAR.A            LINKSHELL.E            BUILDSHELL.E            	ASSM1.E          KKASSM2.E            LINKSHELL.CMD            NEWCC.A            
 LINKNEWCC.CMD            
LINKNEWCC.E            
CSTART         	   	 NEWSHELL            	COPY-DIR          KK NEWSHELL.EDME                                                                                                                                                                                                                                          KK#INCLUDE <STDIO.H>#DEFINE  1#DEFINE  0#DEFINE  90TYPEDEF CHAR ;TYPEDEF CHAR ;/* * TINYEXEC.C - SIMPLE-MINDED, AND KLUDGEY *  "COMMAND FILE PROCESSOR" FOR OWER *   ENVIRONMENT ON THE OMMODORE 64 * *  HIS IS A SMALLEC;    ++ARGV;    *PARGV = ARGV;  RETURN ARGC;EXEC(NARGS, ARGS)UNSIGNED NARGS;CHAR **ARGS;  AUTO CHAR NAME[22];  AUTO CHAR INBUF[];  EARGC = NARGS;  EARGV = ARGS;  EINLINNO = 0;  ENLINOUT = 0;  ENNBLOUT = 0;  ENCRIN = 0/* CURSOR UP */  FOR (I = 0; I < KEYBMAX; ++I)    KEYBUF[I] = 0X0D;  /* KERNAL IDEA OF CARRIAGE RETURN */  IF (NRETURNS > KEYBMAX)    NRETURNS = KEYBMAX;  KEYBNDX = NRETURNS;/* * EXPAND - PRINCIPALLY, CHANGE "\<DIG>" TO ARG * *  ALSO, COUNT \ *   AR 2, 1988 - TO FIX BUG IN PUTOUT() *    WHERE LINES GENERATED OF LENGTH 40 *    OR 41 WEREN'T COUNTED PROPERLY */CHAR **EARGV;UNSIGNED EARGC;UNSIGNED EINLINNO; EFID; EGO; ENLINOUT; ENNBLOUT; ENCRIN;CHAR )     ++EINLINNO;    EXECLN(INBUF);    FCLOSE(EFID);/* * EXECLN - EXECUTE A SINGLE LINE OF *  EXEC INPUT;  USEFUL FOR OUTPUTING *  OUR ERROR MESSAGES! */EXECLN(LINE)CHAR *LINE;  ENCRIN +=    EXPAND(EOUTBUF, LINE, EARGC, EARR C;  REGISTER UNSIGNED N;  UNSIGNED NCRIN;  NCRIN = 0;  P = OUTBUF;  Q = INBUF;  WHILE (*Q == ' ')  /* IGNORE LEADING BLANKS */    ++Q;  WHILE (*Q != '\0')     IF (*Q == '\N')      ++Q;  /* DELETE */    ELSE IF (*Q != '\\')      *P++ = *Q+:EXEC [-N] EXECFILE [ARGS ...]\N");    EXIT(1);    EOUTBUF = OUTBUF;  EXEC(ARGC,ARGV);  IF (EGO ==   DONTEX  RFLAG)    NSTUFF = 0;  ELSE IF (ENCRIN == 0)    NSTUFF = ENNBLOUT;  ELSE    NSTUFF = ENCRIN;  STUFFKB(ENLINOUT, NSTUFF); APPROPRIATE */PUTOUT(LINE, INDENT)CHAR *LINE;UNSIGNED INDENT;  PRINTF("%*.*S%S\N", INDENT, INDENT, "", LINE);  ++ENLINOUT;  IF (STRLEN(LINE)+INDENT >= 40)    ++ENLINOUT;  WHILE (*LINE == ' ')    ++LINE;  IF (*LINE != '\0')    ++ENNBLOUT         --P;        FOR (N = 0; N < ARGC; ++N)           STRCPY(++P, ARGV[N]);          WHILE (*P != '\0') ++P;          *P = ' ';                /* NOTE, LAST BLANK WILL BE OVERWRITTEN */            ELSE         IF (RFLAG)   /* ALLOW THE    P = *ARGV;    WHILE(*++P != '\0')       SWITCH (*P)            CASE 'N':        DONTEX = ;        BREAK;      CASE 'R':        RFLAG = ;        BREAK;      DEFAULT:        *PARGV = ARGV;        RETURN 0;               --ARGHAR *)0X0277)  /* SEE 64  */#DEFINE KEYBMAX (*((CHAR *)0X0289))#DEFINE KEYBNDX (*((CHAR *)0X0C6))STUFFKB(NLINES, NRETURNS)UNSIGNED NLINES, NRETURNS;  REGISTER UNSIGNED I;  KEYBNDX = 0;  FOR (I = 0; I < NLINES; ++I)    PRINTF("%C", 0X91);  R VERSION WITH *   HARDLY ANY FEATURES (FOR 1541 OWNERS) * *  UTHOR: DRIAN EPPER *  ATE: ECEMBER 31, 1987 * *  LACED IN THE PUBLIC DOMAIN BY *   UPLOADING TO RO-INE OWER   *   (416)-276-6811, ANUARY 1988 * *  ODIFICATION HISTORY:;  EGO = ;  IF (NARGS >= 1)     STRNCPY(NAME,ARGS[0],18);    STRCAT(NAME,".E");    IF ((EFID = FOPEN(NAME, "R")) == 0       FERROR())       EXECLN(".ERROR CAN'T OPEN \\0.E");        WHILE (EGO &&    FGETS(INBUF, , EFID) !=R'S TO STUFF KEYBOARD BUFFER COUNT *   (REALLY, \R PROCESSING SHOULD BE DONE ON OUTPUT?) * *  ALSO REMOVE '\N' TO SIMPLIFY */EXPAND(OUTBUF, INBUF, ARGC, ARGV)CHAR *OUTBUF;CHAR *INBUF;INT ARGC;CHAR **ARGV;  REGISTER CHAR *P, *Q;  REGISTER CHA *EOUTBUF; DONTEX; RFLAG;MAIN(ARGC,AV)UNSIGNED ARGC;CHAR **AV;  AUTO CHAR **ARGV;  REGISTER UNSIGNED NSTUFF;  AUTO CHAR NAME[22];  AUTO CHAR OUTBUF[90];  ARGV = AV;  ARGC = OPTION(ARGC, &ARGV);  IF (ARGC < 1)     PRINTF("USAGEGV);  IF (!SPECIAL(EOUTBUF))    PUTOUT(EOUTBUF, 2);  /* ELSE WORK HAS BEEN DONE *//* * PUTOUT - OUTPUT A LINE * *   COUNT NUMBER OF LINES OUTPUT *   COUNT NON-BLANK LINES * * REALLY, HERE WE SHOULD BE ABLE TO *  SUFFIX LINE WITH "\\R"S IF+;    ELSE       /* PROCESS BACKSLASH ESCAPES */      C = *++Q;      IF ('0' <= C && C < '9')         N = C - '0';        IF (N < ARGC)           STRCPY(P, ARGV[N]);          WHILE (*P != '\0') ++P;                    ELSE IF (*Q == '*') 	OPTION(ARGC, PARGV)INT ARGC;CHAR ***PARGV;  CHAR **ARGV;  CHAR *P;  /*   * GLOBALS MUST BE RE-INITED IN CASE   *   WE WERE PRELOADED   */  DONTEX = ;  RFLAG = ;  ARGV = *PARGV;  ++ARGV;  --ARGC;  WHILE (ARGC > 0 && **ARGV == '-') 
;/* * STUFFKB - ARRANGE THAT KERNAL SEES *  APPROPRIATE LINES OF INPUT BY *  CURSORING UP ON THE SCREEN, AND *  STUFFING THE KEYBOARD BUFFER WITH *  CARRIAGE RETURNS, AND THE KEYBOARD *  LENGTH WITH THE APPROPRIATE NUMBER */#DEFINE KEYBUF ((CSE ESCAPES TO EXPAND AGAIN */          /* IS THIS THE RIGHT PLACE TO DO THIS? */          *P++ = '\\';          *P++ = C;                ELSE IF (*Q == 'R')          ++NCRIN;        ELSE  /* UNKNOWN CHAR, JUST REMOVE BACKSLASH */          *P++ = \0';  *PB = B;  T = (STRUCT TOKTBL*)TOKTBL;  /* KLUDGE BECAUSE  OWER  WON'T INIT STRUCTS */  FOR ( ; T->TSTR != ; ++T)    IF (STRCMP(T->TSTR, TOKEN) == 0)      BREAK;  RETURN T->TTYPE;", , */  , ;GETTOK(B, PB)CHAR * ;; DEARC.E - "DE-ARCHIVE" TO RAMDISK (#9);   FROM WORK DRIVE, (#8)WORK 9 0\RSYS 8 0\R.SHIFT.IF \0  .EXEC MVOLD \0  TWINCOPY \0\R  .SHIFT.ENDSYS 9 0\R.IF \0  ; EXEC NOT .EXEC!  EXEC DEARC \*\R.END, */  , ;GETTOK(B, PB)CHAR *E  8#DEFINE  9#DEFINE  10#DEFINE  11SPECIAL(BUF)CHAR *BUF;  AUTO CHAR *BP;  /* NEED TO TAKE & */  REGISTER CHAR *B;   TYPE, ETYPE;  STATIC CHAR *BADELSE = ".ERROR ELSE WITHOUT END";  STATIC CHAR *NOEND = ".ERROR E;; TEXEC1.E - TEST EXEC.SH (SIMPLE STUFF);;  HIS FILE WON'T DO ANYTHING USEFUL,;   BUT TEST SOME OF THE BASIC ARGUMENT;   SUBSTITUTION;\R  RM RUBBISH\R  THIS OTHER STUFF SHOULDN'T GET DONE  \\* IS \*  \0 \1 \2 \3 \4 \5 \6  .SHIFT  ONE SHI;; TEXEC2.E - TEST EXEC.SH (MORE STUFF);; THIS FILE STILL DOESN'T DO ANYTHING;  USEFUL HOWEVER.;; OTE THAT IT USES THE SUBEXEC FILE;  WORKSYS.E;4:\R5:1 STARTS AS \1.PUSHARG7:* STARTS AS \*8:.WHILE \510:RM RUBBISH11:5 IS NOW \5  .SHIFT.E :    IF (RFLAG)    /* CAUSE LINE TO BE OUTPUT */      RETURN ;  /* SO RESULT CAN BE EXEC'D */    IF (*B != '\0') ++B;    PUTOUT(B, 0);    BREAK;  CASE :    /* DO NOTHING */;    RETURN ;STRUCT TOKTBL   CHAR *TSTR;  UNSIGN;; THIS FILE IS A GENERALIZED LINK;; EXEC LINK NAME;;   PRODUCES NAME.SH FROM NAME.O;; EXEC LINK NAME1 NAME2 ...;;   PRODUCES NAME1.SH FROM NAME2 ...;.IF \1  SYS 8 1\R  RM \1.SH\R01 ...  LINK2.9A\R.IF \2  .PUSHARG  .WHILE \2    \2\R 
;; THIS DOESN'T DO MUCH USEFUL, BUT;  DOES DO SOMETHING RELATIVELY HARMLESS,;  AND TESTS .IF/.ELSE/.END QUITE WELL,;  AND IS USED FOR .EXEC BY TEXEC2;; EXEC WORKSYS [ <WRKDEV> [ <WRKDRV> [ <SYSDEV> [ <SYSDRV> ] ] ] ];; DEFAULTS ARE 9 0 9 0  (FOR B;CHAR **PB;  STATIC CHAR TOKEN[10];  CHAR *P;  STRUCT TOKTBL *T;  WHILE (*B == ' ') ++B;  IF (*B == ';') RETURN ;  IF (*B != '.') RETURN ;  ++B;  FOR (P = TOKEN; ('A' <= *B && *B <= 'Z') && P-TOKEN < 8; )    *P++ = *B++;  *P = ' MY  DISK ENVIRONMENT);.IF \2  WORK \1 \2\R  .IF \4    SYS \3 \4\R  .ELSE    .IF \3      SYS \3 0\R    .ELSE      SYS 9 0\R    .END  .END;    .ELSE  .IF \1    WORK \1 0\R  .ELSE    WORK 9 0\R  .END  SYS 9 0\R.END                   C;  /* USEFUL TO GET A BACKSLASH INTO THE OUTPUT */            IF (C != '\0') ++Q;        *P = '\0';  RETURN NCRIN;#DEFINE  0#DEFINE  1#DEFINE  2#DEFINE  3#DEFINE  4#DEFINE  5#DEFINE  6#DEFINE  7#DEFIN;; MVOLD.E - SUB-EXEC FILE TO MAKE A;  BACKUP COPY OF FILE (FOR INSTANCE,;  BEFORE ARCHIVING OR EDITING);; THIS ILLUSTRATES HOW UNPREDICTABLE;  OUTPUT CAN SOMETIMES BE HANDLED;.WHILE \1  RM \1OLD\R01 ...; IF MV FAILS, 2ND ONE DOESN'T GET DONE ; IF MV SUCCEEDS, 2ND ONE SHOULD FAIL AND GENERATE ERROR; EITHER WAY, WE END UP AT RIGHT PLACE  MV \1 \1OLD\R  MV \1 \1OLD\R  .SHIFT.END            LINK.E            WORKSYS.E            MVOLD.E           ND NOT FOUND";  TYPE = GETTOK(BUF, &BP);  B = BP;  SWITCH (TYPE)    CASE :    RETURN ;  CASE :    IF (EARGC > 0)       --EARGC;      ++EARGV;        BREAK;  CASE :    PRINTF("%S\N", B);    EGO = ;    BREAK;  CAS KFT, NOW \\1 IS \1  .SHIFT  ANOTHER SHIFT, NOW \\1 IS \1  AND \\* IS \*            TEXEC1.E                                                                                                                                            END;.PUSHARG16:* IS NOW \*;.WHILE \020:  0 IS NOW \0  .SHIFT  .EXEC WORKSYS \*.END.POPARG24:1 IS NOW \125:* IS NOW \*.POPARG26:1 IS NOW \127:* IS NOW \*28:  THATS ALL FOLKS!                                                                	ED TTYPE;;CHAR *TOKTBL[] = /*"ELSE", , *//*"END", , */  "ERROR", ,/*"IF", ,*/  "SHIFT", ,/*"WHILE", ,*/  "IN", ,/*"EXEC", , *//*"PUSHARG", , *//*"POPARG", , */  , ;GETTOK(B, PB)CHAR *    .SHIFT  .END  .POPARG.ELSE  \1.O\R.END  ^\R\R.IN OUTPUT FILE NAME: \1.SH\R  SYS 9 0\R.ELSE  .ERROR USAGE: EXEC LINK NAME [FILE.O ...].END    LINK.E                                                                            'EXEC' IS A SIMPLE "BATCH", "COMMAND",OR "SCRIPT" FILE PROCESSOR FOR THEOWER  ENVIRONMENT ON THE OMMODORE 64. DARE SAY WITH A LITTLE WORK IT COULDBE ADAPTED TO THE 128 AS WELL.OR DETAILS SEE EXEC.FMT, WHICH SHOULDBE FORMATTED USING THE FOR;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODECE NUMBER = 10       ; SYSTEM DEVICE NUMBER; .REF DPRINTF,DSPRINT,DFPRINT,C$GETCHAR .REF C$FUNCTINIT,CMDLBUF,CURCMDN,ARGV; .REF SRCHCMD,STROUT,STRECHN,DOLOAD .REF OSTDIN,OSTDOUT,OPROUT;; VECTORS TO  LIBRARY ROUTINES;;  THESE ARE NECESSARY THANA SECOND!HERE ARE ALSO SEVERAL SAMPLE 'EXEC'FILES, THE MOST USEFUL OF WHICH ISPROBABLY "LINK.E".OTE THAT ALL THREE VERSIONS OF 'EXEC'BENEFIT GREATLY FROM USING THE "TRIM"CODE IMPROVER.  HIS IS ESPECIALLY TRUEOF THE "EXEC.C" VERSION, WHITHE SHELL TO;  OPERATE WITH THE  DISK;;; SHELLMAIN.A - MAIN LOOP, PLUS ;   STARTUP, INITIALIZATION, NMI;   HANDLING;;  LSO IMPLEMENTS  FUNCTIONS; C$2102 AND $1102;;  UPPORT ADDED FOR DEVICE DRIVERS;   (, , , ).  RIVING OFY INC $1A BNE T0090F INC $1BT0090F RTS;;DINIT LDA # STA SYSDEV LDA # STA WRKDEV LDA #0 STA SYSDRV STA WRKDRV STA CURCMDN .IFNE ɤ,0 LDA CHROUTVEC ; HANDLE CHROUT STA OUTSAV+1 LDA CHROUTVEC+1 STA OUTSAV+2 LDA #<OUTHDL STS LDX SYSDEVBORDER LDA #12 STA $D020     ; BORDER COLORSCREEN LDA #15 STA $D021     ; SCREEN COLORCURSOR LDA #1  ; CURSOR COLOR = WHITE STA CHARCLR JSR OPNSYS LDA #'>       ; PROMPT USER FOR COMMAND LINE JSR CHROUT LDA #$20 JSR CHROUT LDY #0 PRINTER SUPPORTŤ = 1 ; SUPPORT DEVICE DRIVERS;;; SHELL DATA SETUP; .REF USRPROG,SYSDEV,SYSDRV,WRKDEV .REF WRKDRV,STDINFL,STDOUFL,ARGSTK;; KERNAL ROUTINES, ETC; .REF CINT,IOINT,SETLFS,SETNAM,OPEN .REF CLOSE,CHKIN,CHKOUT,CLRCHN,CHR PROGRAM BECAUSE OF /;INTREIN LDX #$FF TXS CLI LDA #13       ; GOTO NEW-LINE JSR CHROUT LDA #<INTHDL  ; HANDLE NMI IRQ'S STA NMIVEC LDA #>INTHDL STA NMIVEC+1 LDA $D018 ORA #$02 STA $D018 LDA #<KWRKFIL JSR OPNWRKMAINLP JSR FILCL INTO CMDLBUF INY BNE T0005BT0020F JSR CHROUT LDA #0 STA CMDLBUF,Y JSR SHEXELN JMP MAINLP;FILCLS JSR CLRCHN ; CLOSE ALL OPEN CHANNELS LDX #15       ; INIT INDEXT0080B TXA PHA JSR CLOSE PLA TAX DEX BNE T0080B RTS;;; THIS IS WHERE WE H2 .BYTE 0,0,0   ; END OF BASIC PROGRAM; .DEF C$START,OUTCHR,OUTLN,CLRSTDO,KWRKFIL .DEF KSYSFIL,FILCLS,OPNWRK,OPNSYS,;; COLOR ATRIBUTES (FOR 'COL' COMMAND); .DEF BORDER,SCREEN,CURSOR;KWRKFIL = 16KSYSFIL = 15 = 8       ; WORK DEVIMAT PROGRAMDISTRIBUTED WITH OWER .LSO INCLUDED IN THIS ARCHIVE ARESMEXEC.C AND TINYEXEC.C A COUPLE OFSMALLER VERSIONS WHICH 1541 USERS MAYFIND PREFERABLE.   FIND 'EXEC' FASTENOUGH TO USE, BUT THEN  USE A 1764 DISK, SO 'EXEC' LOADS IN LESS, AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER  FOR  PROGRAMS;    TO WORK;INIT JMP DINIT JMP C$1102 JMP C$FUNCTINIT JMP DPRINTF JMP DFPRINT JMP DSPRINT JMP C$GETCHAR;JMP C$2102;;; C$2102 - PUSH 0 ONTO  STACK; C$2102 LDA #0;; C$1102 - PUSH A ONTO  STACK;C$1102 LDY #0 STA ($1A), CH MAKESHEAVY USE OF STRUCTURE POINTERREFERENCES.   HAVE NOT NOTICED "TRIM"INTRODUCING ANY BUGS IN THESE PROGRAMS,BUT WATCH CAREFULLY IF YOU MAKE THE'' STRUCTURE ANY BIGGER.SE AND ENJOY.DRIAN EPPER, ANUARY 17, 1988.C' LOADS IN LESS;    PRINTERS W/INTERFACES FOR;   SPECIAL CHARACTERS (, , , , ;   ^).  OVED INPUT BUFFER TO $0200;   COULD CAUSE PROBLEMS, BUT HAVE NOT;   FOR ME.  -> AN ENDIKSEN 01-25-1989;               INK => AN15;ɤ = 1 ; 0 DISABLES A CHROUTVEC LDA #>OUTHDL STA CHROUTVEC+1 .FI .IFNE Ť,0 LDA OPENVEC   ; HANDLE OPEN STA OPENSAV+1 LDA OPENVEC+1 STA OPENSAV+2 LDA #<OPENHDL STA OPENVEC LDA #>OPENHDL STA OPENVEC+1 .FI;;; WE COME BACK HERE AFTER INTERRUPTING;  A 	        ; READ IN USER INPUT (COMMAND LINE)T0005B JSR CHRIN CMP #$0D BEQ T0020F CPY #0        ; CHECK FOR STORING BNE T0010B CMP #'A       ; IGNORE NON-ALPHABETICS AT START OF LINE BCC T0005B CMP #1+'Z BCS T0005BT0010B STA CMDLBUF,Y ; COPY LINE
IN .REF CHROUT,STOP,UNLSN,LISTEN,SECOND,CIOUT; .REF NMIVEC,OPENVEC,CHROUTVEC;CHARCLR=$0286SCRBASE=$0288;; =$0801 - LINK AT -S $0801; .BYTE $0C,$08 ;LINK TO NEXT BASIC STATEMENT .BYTE $0A,$00 ;LINE NUMBER 10 .BYTE $9E,$20,'2,'0,'6,'2 ; SYS 206NOPNO LDY #>SCNOPNO JMP STROUT    ; AND RETURN;T0760F INC $29 ; GOT AN ARG CMP #'" BNE T0780F INX           ; SAVE ARG ENCLOSED IN '"' JSR SAVARGV DEXT0770B INX LDA CMDLBUF,X BEQ SHEXEND CMP #'" BNE T0770B BEQ T0810F;T0780F JSR SAVARGVTANDLE NMI INTERRUPTS;   THIS ALLOWS /ESTORE TO BREAK;   A LOOPING  PROGRAM;INTHDL PHAVINTCNT LDA #0 ; SELF MODIFYING BEQ T0050F PLA           ; SKIP REDUNDANT INTERRUPTS RTIT0050F TXA     ; SAVE REGS PHA TYA PHA LDA #$7F      ; CHECK FOK+1O0210B LDA DEVLST,X ; CHECK AGAINST DEVICE LIST BEQ OPENSAV   ; NO MATCHES, DO NORMAL OPEN CMP ($BB),Y BEQ O0220B INC DEVOK+1   ; MISMATCH, MARKO0220B INX INYO0225B CPY #3  ; SELF MODIFYING BNE O0210BDEVOK LDA #0   ; SELF MODIFYING BNE O02ERNAL COMMAND LDX #<CMDLBUF ; OTHERWISE, TRY AND LOAD A  PROGRAM LDY #>CMDLBUF JSR DOLOAD BCS T0860F JSR EXECMD    ; EXECUTE  PROGRAM IF IT WAS LOADED OKAYT0860F RTS;; STRINGS FOR OPEN FAILURES;SCNOPNI .BYTE "CAN'T OPEN INPUT FILE",13,0SCNOPD THIS CLEARS SCREEN! JSR CINT DEC VINTCNT+1 JMP INTREIN .IFNE ɤ,0;;; HANDLE CHROUT;  FIX SPECIAL CHARACTERS TO ASCII PRINTERS;  FIX OUTPUT TO NULL DEVICE (BIT BUCKET);OUTHDL PHA LDA $BA       ; CHECK OUTPUT DEVICE BEQ O0030B    ; SE $F34A ; DO NORMAL OPENO0120B LDA #3  ; OPEN SCREEN DEVICE BNE O0110B;DEVLST .BYTE "CON","NUL","SCN","PRN",0 .FI;;; SHEXELN - INTERPRET/EXECUTE A LINE;SHEXELN LDY #0 STY $29       ; ARG COUNT STY STDINFL STY STDOUFL LDX #$FF;SHEXLP INX LARGV STA ARGSTK+3; JMP USRPROG;; SAVARGV - SAVE ADDRESS OF CURRENT ARG  ;   INTO ARGV VECTOR FOR COMMAND  ;SAVARGV CLC TXA ADC #<CMDLBUF ; ADD X TO &CMDLBUF STA ARGV,Y INY LDA #0 ADC #>CMDLBUF STA ARGV,Y INY RTS;;; OPNSYS - OPEN A COM0020B LDA $B9 ; SAVE CURRENT SECOND ADDR STA O0025B+1 LDA #$64      ; TRANSPARENT MODE ON PRINTER INTERFACES JSR RELSN PLA PHA JSR CIOUTO0025B LDA #7  ; SELF MODIFYING JSR RELSNO0030B PLA RTSO0040B PLAOUTSAV JMP $F1CA ; DO NORMAL SERVICE (SEL CHECK FOR OUTPUT REDIRECTION BNE T0760F INX LDA CMDLBUF,X; CMP #'>       ; >> MEANS REDIRECT OUT TO PRINTER BNE T0740F JSR OPROUT BCC SHEXLP LDX #<SPRTRNP LDY #>SPRTRNP JMP STROUT    ; AND RETURN;T0740F DEX JSR OSTDOUT BCC SHEXLP LDX #<SCEL FOR;  THE WORK DEVICE; HOULD BE OPENED AND CLOSED ONCE PER;  COMMAND LINE ONLY;OPNWRK LDA #<KWRKFIL LDX WRKDEVT1010F STX SAVDEV+1 PHA           ; TEMP SAVE CHAN NUMBER JSR CLOSE     ; CLOSE CHANNEL BEFORE OPEN PLA LDX SAVDEV+1 LDY #15    LDY #3 LDX #0 LDA ($BB),Y   ; CHECK FILE NAME FOR ':' CMP #': BEQ O0090B LDX #2 LDY #5 LDA ($BB),Y   ; CHECK FILE NAME FOR ':' CMP #': BNE OPENSAVO0090B STX O0200B+1 STY O0225B+1 LDX #0O0200B LDY #0  ; INDEX IN FILE NAME = 0 LDA #0 STA DEV0790B INX     ; SAVE A NORMAL ARG LDA CMDLBUF,X BEQ SHEXEND CMP #$20 BEQ T0800F CMP #$A0T0800F BNE T0790BT0810F LDA #0 STA CMDLBUF,X JMP SHEXLP;SHEXEND LDA $29 BEQ T0860F; JSR SRCHCMD   ; LOOK FOR INTERNAL COMMAND BCC T0860F    ; FOUND INTOR RS232 INTERUPT STA $DD0D LDY $DD0D BPL T0060F JMP $FE72     ; SERVICE RS232T0060F JSR STOP ; CHECK STOP KEY BEQ T0070F JMP $FE72T0070F INC VINTCNT+1 ; DO RUN/STOP-RESTORE LDA $1 ORA #$07 STA $1 LDA #$04 STA SCRBASE JSR IOINT     ; TOO BA00BO0230B CPX #3  ; 'CON' BEQ O0100B CPX #6        ; 'NUL' BEQ O0100B CPX #9        ; 'SCN' BEQ O0120B JMP OPROUT    ; OPEN PRINTER DEVICEO0100B LDA #0  ; OPEN NULL DEVICE STA $B7 ; FILE NAME LENGTH = 0O0110B STA $BA ; DEVICE NUMBEROPENSAV JMPNO .BYTE "CAN'T OPEN OUTPUT FILE",13,0SPRTRNP .BYTE "NO PRINTER",13,0;; EXECMD - CALL A C PROGRAM;   WHICH HAS ALREADY BEEN LOADED AT $2000;EXECMD LDA #<KSYSFIL JSR CLOSE LDA $29 STA ARGSTK LDA #0 STA ARGSTK+1 LDA #<ARGV STA ARGSTK+2 LDA #>RVICE NULL DEVICE CMP #4        ; PRINTER BNE O0040B PLA           ; CHECK CHARACTER BEING OUTPUT PHA CMP #'\ BEQ O0020B CMP #' BEQ O0020B CMP #' BEQ O0020B CMP #' BEQ O0020B CMP #'^ BEQ O0020B CMP #' BEQ O0020B CMP #' BNE O0040BODA CMDLBUF,X BNE T0690F JMP SHEXENDT0690F CMP #$20 BEQ T0700F CMP #$A0T0700F BEQ SHEXLP; CMP #'<       ; CHECK FOR INPUT REDIRECTION BNE T0720F JSR OSTDIN BCC SHEXLP LDX #<SCNOPNI LDY #>SCNOPNI JMP STROUT    ; AND RETURN;T0720F CMP #'> ; 	MAND CHANNEL FOR;  THE SYSTEM (OR ANOTHER) DEVICE; HOULD BE CLOSED BEFORE CALLING USER;  PROGRAM, BUT NOT BEFORE "LS";OPNSYS CPX WRKDEV BEQ RETURN    ; ASSUME SUCCESS LDA #<KSYSFIL BNE T1010F    ; TRY THE OPEN;;; OPNWRK - OPEN A COMMAND CHANN
F MODIFYING);RELSN PHA JSR UNLSN LDA #4 JSR LISTEN PLA JMP SECOND .FI .IFNE Ť,0;;; OPEN HANDLER;  FIX FOR OPEN TO 'CON', 'NUL', 'SCN' & 'PRN' DEVICES;OPENHDL LDA $B7 ; FILE NAME LENGTH BEQ OPENSAV   ; NO FILENAME, NO PROCESSING ;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODE   ; ERRCHAN JSR SETLFS LDA #M$RLEN LDX #<SM$R LDY #>SM$R JSR SETNAM JSR OPEN      ; OPEN TCMDFIL,X,15,"M-R" BCS T1020F    ; NO DEVICESAVDEV LDX #0  ; SELF MODIFYING JSR STRECHN   ; READ, BUT IGNORE, ERRORRETURN CLCT1020F RTS     ; AND RETURN )  ;   (PRESERVE .Y);SCOMS .BYTE ",S",0SCOMW .BYTE ",W",0OSTDOUT LDA #$01 STA STDOUFL STY $2B JSR GETFLNM BCS RETURN LDX #0 JSR STREND DEX DEX LDA STRAC,X CMP #', BEQ T1010F LDX #<SCOMS LDY #>SCOMS JSR STRAPNDT1010F LDX #<SCOMW LDY #THE SHELL TO;  OPERATE WITH THE  DISK;;; DOLOAD.A;; DOLOAD, TRYLOAD;;   LOAD EXECUTABLE PROGRAMS FROM DRIVES;; ALSO GETFLNM;      OSTDIN;      OSTDOUT;      OPROUT;;; .REF SYSDEV,SYSDRV,WRKDEV,WRKDRV .REF STDINFL,STDOUFL;; KERNAL ROTLN LDX T1160F+1 RTSOUTLN LDA STDOUFL BEQ T1130F JSR CLRCHN LDX #2 JSR CHKOUTT1130F LDX #0T1140B CPX STDOUTX+1 BEQ T1150F LDA ARGSTK,X JSR CHROUT INX BNE T1140BT1150F LDA STDOUFL BEQ T1160F JSR CLRCHN LDX #4 JSR CHKIN;T1160F LDX #0  JSR STRECHN BCC T1030F JSR STRBOUT SECT1030F LDX $2A LDY $2B RTS;  ; OPROUT - OPEN PRINTER (DEV 4)  ;   AS STDOUT (PROCESS >>)  ;  OPROUT STX $2A STY $2B LDA #1 STA STDOUFL LDA #2 LDX #4 LDY #7 JSR SETLFS LDA #0 JSR SETNAM JSR OPEN MDLBUF,STROUT;  ; GETFLNM - COPIES FROM CMDLBUF,X  ;   TO STRAC, PREPENDING <DRV>:;; FOR OSTDIN, OSTDOUT;GETFLNM LDA WRKDRV ORA #'0 STA STRAC LDA #': STA STRAC+1T1070B INX LDA CMDLBUF,X BNE T1080F SEC RTST1080F CMP #$20 BEQ T1090F CMP MDNF JSR STROUT SEC RTSSCMDNF .BYTE "COMMAND NOT FOUND",13,0T0880F LDY #$13T0890B LDA ($2A),Y STA CURCMDN,Y DEY BPL T0890B CLC RTS;; TRYLOAD - ATTEMPT LOAD OF ($2A,$2B);  FROM DEVICE X, DRIVE Y  ;SZERO .BYTE "0:",0SDOTSH .BYTE ".SH",0; RTST0870F LDX WRKDEV LDY WRKDRV JSR TRYLOAD ; TRY WORK DISK! BCC T0880F LDX SYSDEV LDY SYSDRV CPX WRKDEV  ; DON'T REDO SAME DISK! BNE T0875F CPY WRKDRV BEQ T0876FT0875F JSR TRYLOAD ; TRY SYSTEM DISK! BCC T0880FT0876F LDX #<SCMDNF LDY #>SC  (PRESERVE .Y);  OSTDIN LDA #$01 STA STDINFL STY $2B JSR GETFLNM BCS RETURN LDA #$01 LDX WRKDEV LDY #$02 JSR STRFOPN ; OPEN 1,WRKDEV,2,STRAC BCS RETURN LDX WRKDEV JMP CMDCHK  ; AND RETURN;  ; OSTDOUT - OPEN STDOUT  ;   (PROCESS >FILENAME  #$04 TAY JSR SETLFS  ; LOAD 4,DEV,4,NAMBUF LDA #$00 JSR LOAD BCC T0970F CMP #5 BNE T0940F RTST0940F LDX VTRYDEV+1 JSR STRECHN;JSR STRBOUT SECT0970F RTSAD OF ($2A,$2B);  FROM DEVICE X, DRIVE Y  ;SZERO .BYTE "0:",0SDOTSH .BYTE ".SH",0;, AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER -- SEC ON ERRORSM$R .BYTE "M-R"M$RLEN = *-SM$R;;; OUTCHR - OUTPUT CHAR (IN A);   TO STDOUT;  NOT FOR USER COMMANDS, SINCE;  ARGSTK USED AS BUFFER;OUTCHR STX T1160F+1STDOUTX LDX #0 ; SELF MODIFYING STA ARGSTK,X INC STDOUTX+1 CMP #$0D BEQ OU>SCOMW JSR STRAPND LDA #2 LDX WRKDEV LDY #3 JSR STRFOPN ; OPEN 2,<WRK>,3,STRAC BCS RETURN LDX WRKDEV;  ; CMDCHK - GET COMMAND CHANNEL LINE  ;  INTO ECHNBUF;  ;  OUTPUT AND SET CARRY IF NON-ZERO CODE;  ALSO RESTORE X,Y FROM $2A,$2B;  CMDCHK UTINES, ETC; .REF SETLFS,SETNAM,OPEN,CHKOUT,CLRCHN,LOAD;;; .DEF GETFLNM,OSTDIN,OSTDOUT,CMDCHK .DEF OPROUT,DOLOAD,TRYLOAD; .REF CURCMDN .REF STRAC   ;; SAME AS PRFBUF, REMEMBER; .REF STRLOAD,STRAPND,STREND,STREQ,STRFOPN .REF STRECHN,STRBOUT,C 5; SELF MODIFYINGCLRSTDO LDA #0 STA STDOUTX+1 RTS; OUTCHR - OUTPUT CHAR (IN A);   TO STDOUT;  NOT FOR USER COMMANDS, SINCE;  ARGSTK USED AS BUFFER;OUTCHR STX T1160F+1STDOUTX LDX #0 ; SELF MODIFYING STA ARGSTK,X INC STDOUTX+1 CMP #$0D BEQ OUBCS T1120F LDX #2 JSR CHKOUTT1120F PHP JSR CLRCHN PLP LDX $2A LDY $2B RTS;; DOLOAD - LOADS NAME REPRESENTED BY STRING AT (X,Y);DOLOAD STX $2A STY $2B JSR STRLOAD LDX #<CURCMDN LDY #>CURCMDN JSR STREQ   ; CMP WITH CURCMDN BNE T0870F CLC	#$A0T1090F BEQ T1070B LDY #2T1100B LDA CMDLBUF,X BEQ T1110F CMP #$20 BEQ T1110F CMP #$A0 BEQ T1110F STA STRAC,Y INY INX BNE T1100BT1110F LDA #0 STA STRAC,Y DEX STX $2A CLCRETURN RTS;  ; OSTDIN - OPEN STDIN  ;  (PROCESS <FILENAME)  ;
TRYLOAD STX VTRYDEV+1 TYA ORA #'0 STA SZERO LDX #<SZERO LDY #>SZERO JSR STRLOAD LDX $2A LDY $2B JSR STRAPND LDX #<SDOTSH LDY #>SDOTSH JSR STRAPND LDX #0 JSR STREND TXA LDX #<STRAC LDY #>STRAC JSR SETNAMVTRYDEV LDX #0 ; SELF-MODIFY LDA;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODE    Y LENGTH OF STRING (X,Y)+1;         A ALWAYS 0;         $57,$58 USED TO STORE X,Y;STRAPND STX $57 STY $58 JSR STREND0 LDY #0T0100B LDA ($57),Y STA STRAC,X INX INY CMP #0 BNE T0100B DEX ; POINT AT '\0' TERMINATOR RTS;;; STREQ - COMPA #$0D BNE T0700B; SHOULD CHECK EOFT0710F LDA #0 STA STRAC,Y JMP CLRCHN  ; AND RETURN;;; STRETST - SET CARRY IF NON-ZERO ERROR;STRETST LDA STRAC ; SET CARRY IF NON-ZERO ERROR ORA STRAC+1 CMP #'0 CLC ; ASSUME GOOD BEQ T0820F SEC  ; ERROR RETTHE SHELL TO;  OPERATE WITH THE  DISK;;; SHELLSTR.A;;   ROUTINES FOR DOING;    STRING MANIPULATION;;  USE OF THESE ROUTINES ACCOUNTS FOR A;  LOT OF THE SPACE SAVING;; .REF WRKDEV;; KERNAL ROUTINES, ETC; .REF SETLFS,SETNAM,OPEN,CHKIN,CE T0210F  ; RETURN NOT EQUAL INY CMP #0 BNE T0200B  ; OR FALL THROUGH, RETURN EQUALT0210F RTS   ; EQUAL;;; STROPEN - OPEN STRAC;; A,X,Y ARE USED AS A CALL TO SETLFS; STRAC IS ASSUMED AS A '\0' TERMINATED; STRING, AND USED FOR CALL TO SETNAM; G0900B LDA ($57),Y BEQ T0910F JSR CHROUT INY BNE T0900BT0910F RTSLRCHN  ; AND RETURN;;; STRETST - SET CARRY IF NON-ZERO ERROR;STRETST LDA STRAC ; SET CARRY IF NON-ZERO ERROR ORA STRAC+1 CMP #'0 CLC ; ASSUME GOOD BEQ T0820F SEC  ; ERROR RETROPEN,STRFOPN,STRECHN .DEF STRETST,STROUT,STRBOUT;;; STRCLR - ZERO WORK STRING BUFFER;  INPUT REGS: NONE;  A IS ALWAYS SET TO ZERO;STRCLR LDA #0 STA STRAC RTS;;; STREND - SET X TO LENGTH OF STRAC;  X SHOULD BE SET BEFORE CALL;   (IN CASE M;; A,X,Y ARE USED AS A CALL TO SETLFS; STRAC IS ASSUMED AS A '\0' TERMINATED; STRING, AND USED FOR CALL TO SETNAM;; IF OPEN FAILS, AN ERROR MESSAGE IS;  COPIED TO STRAC, AND CARRY IS SET;; ALL REGISTERS PLUS STRAC SHOULD BE;  CONSIDERED SCRATCH;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODETH OF STRAC;         Y LENGTH OF STRING (X,Y)+1;         A ALWAYS 0;         $57,$58 USED TO STORE X,Y;STRLOAD JSR STRCLR ; CLEAR STRAC AND GOTO STRAPND;;; STRAPND - COPY STRING AT (X,Y) TO;  END OF STRAC;; OUTPUT: X NEW LENGTH OF STRAC;     O;STRECHN LDA #<KWRKFIL CPX WRKDEV BEQ T0595F LDA #<KSYSFILT0595F TAX JSR CHKIN JSR STRGET JMP STRETST;;; STRGET - READ A LINE FROM CURRENT;  CHKIN FILE,;  THEN DO A CLRCHN;STRGET LDY #0T0700B JSR CHRIN STA STRAC,Y INY BCS T0710F CMP, AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER RE STRING AT (X,Y) TO;  STRAC FOR EQUALITY;; OUTPUT:;  Z CC - EQUAL/NOT;  X - UNCHANGED;  Y - INDEX OF DIFFERING CHAR;  A - CHAR OF (X,Y) THAT DIFFERED (OR '\0');  $57,$58 - X,Y;STREQ STX $57 STY $58 LDY #0T0200B LDA ($57),Y CMP STRAC,Y BNURNT0820F RTS  ; ERROR RETURN;;;; STROUT, STRBOUT;  STROUT OUTPUTS STRING AT (X,Y),;  USING $57,$58 AS POINTER;; STRBOUT CALLS STROUT WITH STRAC;; ALL REGISTERS ARE SCRATCHED;STRBOUT LDX #<STRAC LDY #>STRACSTROUT STX $57 STY $58 LDY #0TLRCHN,CHRIN,CHROUT;;; SHELLSTR - UTILITY ROUTINES TO WORK;  WITH A ZERO-TERMINATED "STRING;  ACCUMULATOR" AT A FIXED ADDRESS;; .REF STRAC  ; SAME AS PRFBUF, REMEMBER .REF KWRKFIL .REF KSYSFIL; .DEF STRCLR,STREND,STRLOAD,STRAPND .DEF STREQ,ST; ALL REGISTERS PLUS STRAC SHOULD BE;  CONSIDERED SCRATCHED;STROPEN JSR SETLFS JSR STREND0 TXA  ; LENGTH OF STRAC IN A LDX #<STRAC LDY #>STRAC  ; SETUP FOR SETNAM JSR SETNAM JMP OPEN  ; AND RETURN, WITH CARRY;;; STRFOPN - OPEN STRAC AS A FILE, AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER 	ULTIPLE STRINGS ARE IN;    STRAC);; OUTPUT: X - LENGTH OF STRAC;STREND0 LDX #0 ; START AT BEGINING OF STRACSTREND INX LDA STRAC-1,X BNE STREND DEX   ; POINT BACK AT END RTS;;; STRLOAD - COPY STRING AT (X,Y) TO;  STRAC;; OUTPUT: X NEW LENG
ED;STRFOPN STX SAVDEV+1 JSR STROPENSAVDEV LDX #0 ; SELF-MODIFY;;; STRECHN - READ ERROR CHANNEL FOR DEVICE;  GIVEN IN X;; REPLACES STRAC WITH ERROR CHANNEL LINE;; ERROR LINE WON'T BE PRINTED, THOUGH; CARRY WILL BE SET IF ERROR LINE IS NON-ZER
 .DEF USRPROG  ; START OF  PROGRAM .DEF FSTATBL  ; TABLE OF FILE I/O STATUSES .DEF CGETCNT  ; NEEDED BY C$GETCHAR .DEF CGETLIM  ;  ... .DEF SYSDEV   ; DEVICE NUMBER OF SYSTEM DISK .DEF SYSDRV   ; DRIVE NUMBER OF SYSTEM DRIVE .DEF WRKDEV   ; DEVICE; C64 KERNAL DEFINITIONS .DEF ACPTR,CHKIN,CHKOUT,CHRIN,CHROUT .DEF CIOUT,CLALL,CLOSE,CLRCHN,GETIN .DEF CINT,IOBASE,IOINT,LISTEN,LOAD .DEF MEMTOP,OPEN,PLOT,RAMTAS,RDTIM .DEF READST,RESTOR,SAVE,SCNKEY,SETLFS .DEF SETNAM,SCREEN,SECOND,SETMSG,SETTIM . CGETCNT=$17F7CGETLIM=$17F8SYSDEV=$17FASYSDRV=$17FBWRKDEV=$17FCWRKDRV=$17FDSTDINFL=$17FESTDOUFL=$17FF;ARGSTK=$033C   ; IE CASSETTE BUFFER;DEV   ; DEVICE NUMBER OF SYSTEM DISK .DEF SYSDRV   ; DRIVE NUMBER OF SYSTEM DRIVE .DEF WRKDEV   ; DEVICE= $FF81IOBASE = $FFF3IOINT = $FF84LISTEN = $FFB1LOAD = $FFD5MEMTOP = $FF99OPEN = $FFC0PLOT = $FFF0RAMTAS = $FF87RDTIM = $FFDEREADST = $FFB7RESTOR = $FF8ASAVE = $FFD8SCNKEY = $FF9FSETLFS = $FFBASETNAM = $FFBDSCREEN = $FFEDSECOND = $FF93S;; SHELLRAM;;  Y: DRIAN EPPER;      ORONTO, NTARIO;;  BASED ON, BUT HEAVILY MODIFIED FROM;  THE RO-INE/PINNAKER;     /  SHELL FOR THE;  OMMODORE 64 HOME COMPUTER.;;  HE SHELL WAS MODIFIED TO REDUCE;  THE SIZE OF THE CODE   LINK -S $0801\R  SHELLMAIN.O\R  C$GETCHAR.O  DPRINTF.O\R  DOLOAD.O\R  SRCHCMD.O\R  SHELLSTR.O\R  SHELLCENV.O\R  C64KERNAL.O\R  SHELLVAR.O\R\R.IN OUTPUT FILE NAME: SHELLXXX   SHELLVAR.A                                          THE SHELL TO;  OPERATE WITH THE  DISK;;; SHELLVAR.A - ;    FORCES SOME STUFF TO FOLLOW;    SHELL PROGRAM;ARGV .DSEG 20*2 ; PLACE AT END OF CODE;;; THESE ARE FORCED UP TO PAGE $17, TO;   LEAVE PAGE $16 FREE FOR  DISK;   INTERFACE PAGE; 7EXEC ASSM1 SHELLMAIN.A DOLOAD.A DPRINTF.A SRCHCMD.A\RINTF.O\R  DOLOAD.O\R  SRCHCMD.O\R  SHELLSTR.O\R  SHELLCENV.O\R  C64KERNAL.O\R  SHELLVAR.O\R\R.IN OUTPUT FILE NAME: SHELLXXX   SHELLVAR.A                                           THE SHELL TO;  OPERATE WITH THE  DISK;;; SHELLCENV.A;;   HIS IS THE DEFINITIONS OF LOCATIONS;  IN THE   HELL WHICH ARE REFERENCED;  FROM WITHIN  PROGRAMS.  T IS IMPORTANT;  THAT THESE BE SET UP FOR  PROGRAMS;  TO WORK PROPERLY.; .SHIFT.IF \0  ASSM -L \0\R  ASM  NAME  ERRORS.END.SHIFT.IF \0  EXEC ASSM1 \*\R.ELSE  EXEC ASSM2 SHELLVAR.A SHELLSTR.A C$GETCHAR.A SHELLCENV.A C64KERNAL.A\R.ENDNAME: SHELLXXX   SHELLVAR.A                                           NUMBER OF WORK DISK .DEF WRKDRV   ; DRIVE NUMBER OF WORK DRIVE .DEF STDINFL  ; FLAG INDICATING STDIN REDIRECTED .DEF STDOUFL  ; FLAG INDICATING STDOUT REDIRECTED .DEF ARGSTK   ; WHERE  FUNCTION ARGS GO (AS FOR MAIN());USRPROG=$1800FSTATBL=$17E7DEF SETTMO,STOP,TALK,TKSA,UDTIM .DEF UNLSN,UNTLK,VECTOR; .DEF IRQVEC,BRKVEC,NMIVEC,OPENVEC,CHROUTVEC;ACPTR = $FFA5CHKIN = $FFC6CHKOUT = $FFC9CHRIN = $FFCFCHROUT = $FFD2CIOUT = $FFA8CLALL = $FFE7CLOSE = $FFC3CLRCHN = $FFCCGETIN = $FFE4CINT  w.SHIFT.IF \0  ASSM -L \0\R  ASM  NAME  ERRORS.END.SHIFT.IF \0  EXEC ASSM2 \*\R.ELSE  EXEC LINKSHELL\R.ENDSHELLSTR.A C$GETCHAR.A SHELLCENV.A C64KERNAL.A\R.ENDNAME: SHELLXXX   SHELLVAR.A                                           ETMSG = $FF90SETTIM = $FFDBSETTMO = $FFA2STOP = $FFE1TALK = $FFB4TKSA = $FF96UDTIM = $FFEAUNLSN = $FFAEUNTLK = $FFABVECTOR = $FF8D;IRQVEC = $0314BRKVEC = $0316NMIVEC = $0318OPENVEC = $031ACHROUTVEC = $0326;CHN = $FFCCGETIN = $FFE4CINT , AND ARRANGE;  THINGS SO MEMORY PAGE 22 (HEX $16);  WILL BE FREE FOR USE AS A "DISK;  NTERFACE AGE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER    LINK -S $0801    SHELLMAIN.O  C$GETCHAR.O  DPRINTF.O  DOLOAD.O  SRCHCMD.O  SHELLSTR.O  SHELLCENV.O  C64KERNAL.O  SHELLVAR.O    OUTPUT FILE NAME: SHELLXXX     SHELLVAR.A                                           k .DEF CURCMDN,CGETCBF,PRFBUF,STRAC;CURCMDN=$17E7-20CGETCBF=CURCMDN-81PRFBUF=CGETCBF-128STRAC=PRFBUFE", FOR USE WITH THE;  OMMODORE 1764 256  EXPANDER;  FOR THE OMMODORE 64;;  HIS (BASICALLY) ALLOWS ALL PROGRAMS;  DESIGNED TO RUN UNDER 	;; NEWCC.A;  - SOURCE FOR OWER  OMPILER DRIVER;; DRIAN EPPER, ARCH 8, 1988; .REF ARGSTK .REF SYSDEV .REF SYSDRV .REF WRKDEV .REF WRKDRV; .REF SETLFS .REF SETNAM .REF OPEN .REF CLOSE .REF CHKIN .REF CHKOUT .REF CLRCHN .REF CHRIN 
AT LEAST 1 CHAR;GETBLK = * STX $22 STY $23 STA $24 LDY #0T0510 JSR CHRIN STA ($22),Y INY JSR READST BNE T0520 CPY $24 BNE T0510T0520 RTS;;PUTBLK = * STX $22 STY $23 STA $24 LDY #0 BEQ T0540T0530 LDA ($22),Y JSR CHROUT INYT0540 C  ; DEFAULT PROMPT FOR DISKS LDA #'R     ; DEFAULT "REGISTER" VARS STA $03FF .IFEQ RAMDISK,0 LDX #0START1 LDA NORAM,X BEQ ARGLP JSR CHROUT INX BNE START1 .FIARGLP DEC ARGSTK BEQ USAGE  ; SHOULDN'T END WITH AN OPTION CLC LDA ARGSTK+2 ADC #2TEMP1 JSR SETNAM JSR OPEN    ; 2,WORK,2,STEMP1 JSR RCMDCHN BEQ T0520F LDX #<SCNOOF LDY #>SCNOOF JSR OUTSTR LDA #2 JSR CLOSE JMP CLSCMD;T0520F LDA #3 LDX WRKDEV TAY JSR SETLFS LDA #T2LEN LDX #<STEMP2 LDY #>STEMP2 JSR SETNAM JSR OPEN   HANGES STA PFLAG JMP DASHLPT0200F CMP #'A BNE T0210F STA $03FF JMP DASHLPT0210F CMP #'S BNE USAGE STA $03FF JMP DASHLP; .IFEQ RAMDISK,0NORAM .BYTE "NO COMPILES ON RAM DISK",13,0 .FI;USAGE LDX #<SUSAGE LDY #>SUSAGEOUTSTR STX $4B STY $4CSR CHROUT LDX #<SRCNAM LDY #>SRCNAM   ; NOW SOURCE.O JSR OUTSTR LDA #'= JSR CHROUT LDX #0T0610B LDA STEMP2,X JSR CHROUT INX CPX #T2LEN-4 BNE T0610B LDA #', JSR CHROUT LDX #0T0620B LDA STEMP1,X JSR CHROUT INX CPX #T1LEN-4 BNE T0620B LDF STX SRCLEN DEY LDA ($4D),Y CMP #'C BNE T0330F DEY LDA ($4D),Y CMP #'. BEQ T0340FT0330F LDX #<SNCSF LDY #>SNCSF JMP OUTSTRT0340F LDA WRKDRV CLC ADC #'0 STA SRCNAM STA SSTEMP+1 STA STEMP1 STA STEMP2 LDA SYSDRV ADC #'0 STA SIZERO+1 SDY #>SRCNAM JSR SETNAM JSR OPEN    ; 2,WORK,2,SRCNAM.O,W JSR RCMDCHN BEQ T0620F LDX #<SCNOOF LDY #>SCNOOF JSR OUTSTR JMP BADCAT;T0620F LDA #T2LEN-4 LDX #<STEMP2 LDY #>STEMP2 JSR TCOPY   ; COPIES TO 2, USING 3; LDA #T1LEN-4 LDX #<STEMP1 LLDA $FE BEQ T0400F JSR IDISKS JMP CLSCMD ; AND RETURN TO SHELL;T0400F LDX #<SINSCMP LDY #>SINSCMP JSR PROMPT JSR IDISKS LDA #2 LDX SYSDEV TAY JSR SETLFS LDA #TRNLEN LDX #<BTRNNAM LDY #>BTRNNAM JSR SETNAM LDA #0 JSR LOAD BCC DOTRANS LD 2 JSR CHKOUT TYA ; TRANSFER COUNT LDX #<BUFF LDY #>BUFF JSR PUTBLK PLA  ; GET BACK READST BEQ TCOPYLP; JSR CLRCHN LDA #3 JMP CLOSE   ; AND RETURN;; GETBLK MAX (X,Y);;  RETURNS READST;    Y IS COUNT;; C64 KERNAL IS SUCH BLOCK MUST BE;  .REF CHROUT .REF READST .REF LOAD .REF GETIN;;RAMDISK = 0  ; NON-ZERO ASSEMBLES RAMDISK VERSION;; * = $1800  ; USE LINK -S $1800;;  LINK -S $1800;> NEWCC.O;> USRPROG.O;> C64KERNAL.O;>;USRPROG JMP START JMP OPNSRCSTART LDA #1 STA PFLAG R CHKOUT LDX SRCLEN DEX;; SCRATCH OLD OBJECT FILE, IF ANY; LDA #'O STA SRCNAM,X LDA #'S JSR CHROUT LDX #<SRCNAM LDY #>SRCNAM JSR OUTSTR LDA #$0D JSR CHROUT JSR RCMDCHN LDA #2 LDX WRKDEV TAY JSR SETLFS LDA #T1LEN LDX #<STEMP1 LDY #>S STA ARGSTK+2 STA $4B LDA ARGSTK+3 ADC #0 STA ARGSTK+3 STA $4CT0100F LDY #1 LDA ($4B),Y STA $4E DEY LDA ($4B),Y STA $4D LDA ($4D),Y CMP #'- BNE NODASHDASHLP INY LDA ($4D),Y BEQ ARGLP CMP #'P BNE T0200F LDA #0    ; DON'T PROMPT DISK C; 3,WORK,3,STEMP2 JSR $2000 LDA #3 JSR CLOSE LDA #2 JSR CLOSE; LDA $FE    ; 0 INDICATES OKAY RETURN BEQ CONCAT JMP SCRTEMP  ; AND RETURN TO SHELL;;;CONCAT = * .IFEQ RAMDISK,0 JSR CMDOUT LDA #'C  ; CONCATENATE TEMP FILES INTO NEW OBJECT J LDY #0T0240B LDA ($4B),Y BEQ T0250F JSR CHROUT INY BNE T0240BT0250F RTS;NODASH = * ; ASSERT ARGSTK (COUNT) != 0T0300F LDY #0 LDX #2T0310B LDA ($4D),Y STA SRCNAM,X  ; FILE NAME INCLUDING '\0' IS STORED BEQ T0320F INY INX BNE T0310BT0320A #$0D JSR CHROUT JSR RCMDCHN LDX #15 JSR CHKOUT; .ELSE; LDX #<SCATFIL LDY #>SCATFIL JSR OUTSTR LDA #2 LDX WRKDEV TAY JSR SETLFS LDX SRCLEN LDA #', STA SRCNAM,X INX LDA #'W STA SRCNAM,X INX LDA #0 STA SRCNAM,X TXA LDX #<SRCNAM LTA BCMPNAM STA BTRNNAM LDA #2 LDX SYSDEV TAY JSR SETLFS LDA #CMPLEN LDX #<BCMPNAM LDY #>BCMPNAM JSR SETNAM LDA #0 JSR LOAD BCC DOCOMP LDX #<SCDNP LDY #>SCDNP JMP OUTSTRDOCOMP LDA WRKDEV STA $FE JSR $2000 LDA #2 JSR CLOSE JSR CLSCMD DY #>STEMP1 JSR TCOPY   ; COPIES TO 2, USING 3 JMP BADCAT;TCOPY = * JSR SETNAM LDA #3 LDX WRKDEV TAY JSR SETLFS JSR OPEN    ; 3,WORK,3,XXXTEMPN;TCOPYLP LDX #3 JSR CHKIN LDX #<BUFF LDY #>BUFF LDA #254 JSR GETBLK PHA  ; SAVE READST LDX #
X #15 JSR CHKINT0410B JSR CHRIN PHA JSR CHROUT PLA CMP #$0D BNE T0410B JSR CLRCHN LDX #<SCDNP LDY #>SCDNP JMP OUTSTRDOTRANS LDX #<SINSOBJ LDY #>SINSOBJ JSR PROMPT JSR CMDOUT LDX #<SSTEMP LDY #>SSTEMP JSR OUTSTR JSR RCMDCHN LDX #15 JSTE $0D, $00STEMP1 .BYTE "0:XXXTEMP1,S,W"T1LEN = *-STEMP1  .BYTE $00STEMP2 .BYTE "0:XXXTEMP2,S,W"T2LEN = *-STEMP2 .BYTE $00BCMPNAM .BYTE "0:COMPILER"CMPLEN = *-BCMPNAMBTRNNAM .BYTE "0:TRANSLATOR"TRNLEN = *-BTRNNAMSRCLEN .BYTE $00SRCNAM .BYTE "   NEWSHELL:  SHELL FOR       DESIGNED TO WORK WITH THE          1764  DISK HE FILES IN THIS ARCHIVE ALLOW YOUTO ASSEMBLE, USING C/ASSM, AND LINK,USING THE   LINKER, A SHELL WHICHCAN BE USED ON THE OMMODORE 64 INCONJUNCTION WITAND RETURN;IDISKS JSR CLSCMD LDX SYSDEV CPX WRKDEV BEQ SAMEDEV LDA #15 TAY JSR SETLFS LDA #1 LDX #<SIZERO LDY #>SIZERO JSR SETNAM JSR OPEN JSR CLSCMD LDX WRKDEVSAMEDEV LDA #15 TAY JSR SETLFS LDA #1 LDX #<SIZERO LDY #>SIZERO JSR SETN  128 SHELL:COL <CHAR> <BACKGROUND> <DUMMY> <BORDER>2) INCE LEADING NON-ALPHABETICS AREALWAYS IGNORED ON EACH COMMAND LINE,LINES CAN EASILY BE RE-ENTERED BYCURSORING UP TO THEM AND PRESSING<RETURN>.  OME PEOPLE MIGHT NOT LIKETHIS IF THEY  SETNAM JSR OPEN LDA #2 LDX WRKDEV TAY JSR SETLFS LDX #<SRCNAM LDY #>SRCNAM LDA SRCLEN JSR SETNAM JSR OPEN    ; 2,WORK,2,SRCNAM BCS T0720F JSR RCMDCHN BNE T0720F CLC BCC T0730FT0720F LDA #2 JSR CLOSE LDX #<SSFNF LDY #>SSFNF SECT0730F FEATURES,SOME MAY WISH TO USE IT FOR JUST THATREASON.O ASSEMBLE IT WILL REQUIRE THE C/ASSMPROGRAM, FROM ARK INFRET AND AYARLING.  ACH ".A" FILE FROM THISARCHIVE SHOULD BE ASSEMBLED TO PRODUCETHE CORRESPONDING ".O".INKING WILL REQUIRE THR CLRCHN LDA #15 JMP CLOSE;PROMPT LDA PFLAG BNE T0900F RTST0900F JSR OUTSTRT0910B JSR  GETIN CMP #$0D BNE T0910B RTSSUSAGE .BYTE "USAGE:  CC [-PAS]"  .BYTE " FILENAME" .BYTE $0D, $0D, $00SCDNP .BYTE "COMPILER DISK NOT PRESENT" .BYTE $0D, K SHOULD FIRST BE INITIALIZED,USING PAGE 22 (HEX $16) AS THE INTERFACE PAGE.  HE SMALL BASIC PROGRAMON THE DISK, 'CSTART', ACTUALLY DOESTHIS FOR YOU.  T REQUIRES A COPY OF THE DISK BINARY IMAGE, RAMDOS??????.BAS,TO BE COPIED ONTO THE DISK.  H NCSF .BYTE "NOT A  SOURCE FILE" .BYTE $0D, $0D, $00SCNOOF .BYTE "CAN'T OPEN OBJECT FILE" .BYTE $0D, $0D, $00SCATFIL .BYTE $0D .BYTE "...CONCATENATING OBJECT FILE..." .BYTE $0D, $00SIZERO .BYTE "I0:" .BYTE $0D, $00SSTEMP .BYTE "S0:XXXTEMP*" .BYORK 8 0.  O CHANGE THESE SETTINGS,MODIFY THE VARIABLES  AND  INSHELLMAIN.A.XTRA FEATURES IN 'NEWSHELL':1) A 'COL' COMMAND CAN BE OPTIONALLYASSEMBLED IN (THE SOURCE IS DISTRIBUTEDTO PROVIDE IT), COMPATIBLE WITH THE'COL' COMMAND OF THE PY $24 BNE T0530 RTS;BADCAT = * LDA #2 JSR CLOSE .FI;; JSR SCRTEMP LDX ARGSTK DEX BEQ T0600F JMP ARGLP;T0600F RTS ; RETURN TO SHELL;SCRTEMP LDX #15 JSR CHKOUT LDX #<SSTEMP LDY #>SSTEMP JSR OUTSTR JSR RCMDCHN LDA #15 JMP CLOSE  ;  $0:" .BSS 22PFLAG .BSS 1BUFF = *BYTE $0D, $0D, $00SCNOOF .BYTE "CAN'T OPEN OBJECT FILE" .BYTE $0D, $0D, $00SCATFIL .BYTE $0D .BYTE "...CONCATENATING OBJECT FILE..." .BYTE $0D, $00SIZERO .BYTE "I0:" .BYTE $0D, $00SSTEMP .BYTE "S0:XXXTEMP*" .BYAM JMP OPEN  ; AND RETURN;; OPEN SOURCE FROM INSIDE COMPILER;OPNSRC LDA 1 PHA ORA #$07 STA 1 CLI LDX #<SINSSRC LDY #>SINSSRC JSR PROMPT LDA SSTEMP+1 STA SIZERO+1 LDA #15 LDX WRKDEV TAY JSR SETLFS LDA #3 LDX #<SIZERO LDY #>SIZERO JSRH THE OMMODORE 1764256 AM XPANDER, SINCE IT LEAVESA PAGE OF MEMORY FREE FOR USE AS THE" ISK NTERFACE AGE", AS REQUIREDBY THE  ISK OFTWARE AS PROVIDEDWITH THE CARTRIDGE.HE SHELL CAN BE USED WITHOUT THE 1764ALSO.  S IT HAS MANY NEW SEI PLA STA 1 RTSRCMDCHN LDX #15 JSR CHKIN JSR CHRIN CMP #'0 BNE T0800F JSR CHRIN CMP #'0T0800F PHPT0810B JSR CHRIN CMP #$0D BNE T0810B JSR CLRCHN PLP  ; FOLLOW WITH BEQ FOR OKAY RTS;CMDOUT LDX #15 JMP CHKOUT ; AND RETURN;CLSCMD JSE   (OR OWER) LINKER, AS FOLLOWS:$ LINK -S $0801> SHELLMAIN.O> C$GETCHAR.O> DPRINTF.O> DOLOAD.O> SRCHCMD.O> SHELLSTR.O> SHELLCENV.O> C64KERNAL.O> SHELLVAR.O>OUTPUT FILE NAME: NEWSHELL$O RUN IT, USING THE  DISK, THE DIS$0D, $00SSFNF .BYTE "SOURCE FILE NOT FOUND" .BYTE $0D, $0D, $00SINSSRC .BYTE $0D .BYTE "INSERT SOURCE DISK" .BYTE $0D, $0D, $00SINSCMP .BYTE $0D .BYTE "INSERT COMPILER DISK" .BYTE $0D, $00SINSOBJ .BYTE "INSERT OBJECT DISK" .BYTE $0D, $0D, $00S	ISPROGRAM SHOULD HAVE COME WITH YOUR 1764 EXPANDER.  'CSTART' ALSO ARRANGES TOUSE THE 'EXEC' UTILITY (WHICH YOU MAY ORMAY NOT HAVE), TO SET UP YOUR  DISKFOR USE.HE COPY OF NEWSHELL INCLUDED IN THISARC IS DESIGNED TO RUN WITH SYS 10 0 ANDW
ANOTHER ALSO ON THE DISK      A) IS  SLOW   B) GENERATES ERRONEOUS OUTPUT      CHARACTERS (AT 256 BYTE INTERVALS) MULTIPLE CHARACTER BUFFER MUST BEUSED, WHICH IS GENERALLY BETTERPROGRAMMING PRACTICE, ANYWAY.2) (OSSIBLY RELATED)HILE                       INK: AN15HE FILE 'NEWCC.A' IS A C/ASSM SOURCETO PRODUCE A OF VERSION OF THE 'CC.SH'PROGRAM WHICH WILL WORK WITH BOTH 'SYS'AND 'WORK' DEVICES SET TO BE THE DISK.  HE 'COMPILER' AND 'TRANSLATOR'PROGRAMS FROM THE  ONE ERRONEOUS OUTPUT BYTE.   DON'T KNOWWHETHER THIS IS BECAUSE OF THE NATUREOF THE CONDITIONAL COMPILE, BECAUSE ITUSES A .DSEG, OR SOME OTHER PROBLEM.           -- DRIAN EPPER              ARCH, 1988TICE, ANYWAY.2) (OSSIBLY RELATED)HILEOGRAM TO BECOMPILED WITH A SINGLE COMMAND LINE.OTE THAT 'NEWCC' MUST BE LINKED WITHTHE OBJECT FILE 'SHELLCENV.O' TO RESOLVESOME OF ITS' REFERENCES.OTE THAT 'NEWCC' CAN BE ASSEMBLED TO BENON-RAM DRIVE COMPATIBLE IF YOU DON'TWANT TO COMPILE ON TK "LS >", AND,MEANS THAT PROGRAMS LOADED FROM THESYS DRIVE OF THE DUAL DRIVE CAN DOFILE REDIRECTION THE FIRST TIME THEYARE LOADED.  F YOU HAVE A DUAL DRIVE,YOU MIGHT KNOW WHAT  MEAN.  THERWISE,DON'T WORRY ABOUT IT.4) HE PROMPT IS '>' RATHER TH'CSTART' IS FOR THE RAM DRIVEUSERS.  T WILL INSTALL THE RAM DRIVEAND COPY A LIST OF FILES AS DIRECTEDFROM THE FILE 'COPY-DIR'.  HERE ARETHREE COMMANDS THAT IS OBEYS FROM THE'COPY-DIR' FILE.  'PAUSE' WILL PROMPTTHE USER FOR A NEW DISK AND WAIT FORWOULD SENDOUTPUT TO THE PRINTER).  HE DEVICES AREONSUL (KEYS), RINTER, CREEN AND (EMPTY DEVICE, GOOD FOR GETTING NOOUTPUT).  F YOU DON'T WANT THIS OPTION,SET Ť TO ZERO IN SHELLMAIN.A6) 01-25-1989: UPPORT ADDED FOR PRINTERS AN15 WITH THE 1764 NTERFACE, ANDTHE  SOFTWARE IN PARTICULA(N ADDITION TO THOSE NOTED IN THEOMMODORE DOCUMENTATION):1)  SIMPLECHKIN,CHRIN,CLRCHN,CHKOUT,CHROUT,CLRCHNLOOP TO ATTEMPT TO COPY FROM ONE FILEON THE  DISK TO DDED MORE NAMES FORBUILT IN COMMANDS.  HE COMMANDS ARE'TYPE' FOR 'PR', 'DIR' FOR 'L', 'DIRS'FOR 'LS', 'DEL' FOR 'RM', AND 'REN' FOR'MV'.  F YOU DON'T WANT THIS OPTION,SET  TO ZERO IN SHELLMAIN.A-> TEMS 5, 6, 7 MADE BY AN ENDIKSEN   PREPARING THE SHELL SOURCEITSELF FOR DISTRIBUTION,  DISCOVEREDTHAT ASSM.SH GENERATED ERRONEOUS OUTPUTWHEN ASSEMBLING A FILE ON/TO THE DISK.  UT THIS WAS ONLY IN ONE CASE:HE FILE SRCHCMD.A, WHEN THE SYMBOLCOLCMD IS SET TO ZERO, WILL GENERATE  64DISTRIBUTION DISK SHOULD BE COPIED TOTHE  DISK, AS WELL AS THE  SOURCETO BE COMPILED FOR THIS VERSION TO WORK.(T WILL ALSO WORK WITH REAL DISKDRIVES, HOWEVER).  N ADDITION TOSUPPORTING THE  DISK, 'NEWCC' ALSOALLOWS MORE THAN ONE  PRKHAVE TAKEN TO SAYING THINGSLIKE ">> PRINT ...", BUT "PRINT ... >>"IS EQUIVALENT.3) ETTER MANAGEMENT IS DONE OF THEFILE UNITS USED FOR COMMAND CHANNELS.HIS IS PRIMARILY OF SIGNIFICANCE TOUSERS OF DUAL DISK DRIVES, SUCH AS THE -2.  T ALLOWSHE RAM DRIVE.  TWORKS FINE WITH THE RAM DRIVE AS A DRIVE.  HE MAIN PROBLEM THAT 'CC' HASWITH THE RAM DRIVE IS THAT THE DOS COPYCOMMAND IS NOT FULLY SUPPORTED.HEREFOR IT SUPPLIES ITS' OWN SLOWERCOPY ROUTINE FOR THE RAM DRIVE USEAGE.HE FILE AN '$' TOREMIND YOU IT'S DIFFERENT.  F COURSE,YOU CAN MODIFY THE SOURCE TO USEWHATEVER CHARACTER YOU LIKE.5) 01-25-1989: EVICE DRIVER SUPPORT HASBEEN ADDED FOR DEVICES 'CON', 'PRN','NUL' AND 'SCN'.  HESE ARE MAINLY FORREDIRECTION (IE. '>PRN:' INPUT.  'SOURCE' WILL SET THE SOURCEDEVICE AND DRIVE.  'DESTINATION' WILLSET THE DESINATION DEVICE AND DRIVE.OURCE AND DESTINATION EXPECT TWO DIGITSFOR THE DEVICE NUMBER (IE: SOURCE=08 0).ILE COPY ADDED BY AN ENDIKSEN                   INK: 	 TO ALLOW PRINTING OF CHARCTERS'', '', '', '' AND '^' WITHOUTFORCING THE PRINTERS INTERFACE TO USEBIT-GRAPHICS.  F YOU DON'T WANT THISFEATURE (CAUSES PROBLEMS WITH NORMALOMMODORE PRINTERS), SET ɤ TOZERO IN SHELLMAIN.7) 01-25-1989: KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK